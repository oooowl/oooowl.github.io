import{o as Me,X as ze,K as Ee,L as ce,G as Ge,R as Le,e as X,a as Se,k as c,b as ve,Q as Be,x as de,Y as Ye,n as je,N as He,O as Ve}from"../chart.md.hi_nZSnT.js";import{x as Xe}from"./Title-DYNLqCCT.D6xZGHSM.js";import{s as De,i as Re}from"./usePrinter-8ofTb2MJ.pt_J2AaR.js";import{W as We}from"./DataTable-DL2agEJ3.DwhyhpBD.js";import Ae from"./vue-ui-accordion-D_1fE5EF.ggAyum2g.js";import Ke from"./vue-ui-skeleton-B2sRnIXX.C3JvNOY7.js";import{c as he}from"./useNestedProp-S1UXxUgm.CErBICdk.js";import{p as Qe}from"./PackageVersion-DtnhR89q.DeJ10Meb.js";import{s as qe}from"./vue-data-ui-Cp7bO_tj.DKBrIOIj.js";import{h as f,v as Ze,p as b,q as Je,o as r,c as h,b as E,e as T,aj as Ue,w as k,r as x,ak as fe,al as ge,k as i,n as me,N,G as pe,j as G,F as P,C as I,t as D,a as et,P as tt}from"./framework.BaNfDZ-f.js";import"./Shape-CO_Ak9Zm.UkrUmJI7.js";const lt=["id"],ot={key:0,style:"width:100%;background:transparent;padding-bottom:24px"},at=["xmlns","viewBox"],st=["id"],nt=["stop-color"],ut=["stop-color"],rt=["d","fill","stroke","stroke-width"],it=["x","y","height","width","fill","stroke","stroke-width","onMouseenter"],ct=["x","y","font-size","fill"],vt=["x","y","font-size","fill"],dt={key:2,class:"vue-data-ui-watermark"},ht=["innerHTML"],ft={__name:"vue-ui-flow",props:{config:{type:Object,default(){return{}}},dataset:{type:Array,default(){return[]}}},setup(ye,{expose:be}){const m=ye,{vue_ui_flow:ke}=Me(),L=f(()=>!!m.dataset&&m.dataset.length);Ze(()=>{R()});function R(){ze(m.dataset)&&Ee({componentName:"VueUiFlow",type:"dataset"})}const S=b(ce()),W=b(null),A=b(0),K=b(0),_=b(!1);function we(t){_.value=t,A.value+=1}const e=f({get:()=>Q(),set:t=>t});function Q(){const t=he({userConfig:m.config,defaultConfig:ke});return t.theme?{...he({userConfig:Ge.vue_ui_flow[t.theme]||m.config,defaultConfig:t}),customPalette:Le[t.theme]||X}:t}Je(()=>m.config,t=>{e.value=Q(),R(),K.value+=1},{deep:!0});const{isPrinting:q,isImaging:Z,generatePdf:J,generateImage:U}=De({elementId:`flow_${S.value}`,fileName:e.value.style.chart.title.text||"vue-ui-flow"}),B=f(()=>Se(e.value.customPalette)),ee=f(()=>e.value.style.chart.nodes.gap),$=f(()=>e.value.style.chart.nodes.width),F=b({showTable:e.value.table.show}),te=f(()=>e.value.style.chart.links.width),Y=f(()=>!m.dataset||!m.dataset.length?[]:m.dataset.map(t=>[t[0],t[1],c(t[2])])),le=f(()=>{const t={};function o(a){t[a]||(t[a]={inflow:0,outflow:0})}Y.value.forEach(([a,n,g])=>{o(a),o(n),t[a].outflow+=g,t[n].inflow+=g});let l=0;for(const a in t){const n=Math.max(t[a].inflow,t[a].outflow);l=Math.max(l,n)}return l});function xe(t){return t/le.value*100+e.value.style.chart.nodes.minHeight}function $e(t){const o=e.value.style.chart.nodes.minHeight;return(t-o)/100*le.value}function Ce(t){const o={},l={};function a(s,u){o[s]||(o[s]={height:0,level:null,inflow:0,outflow:0}),o[s].level===null&&(o[s].level=u),l[u]||(l[u]=[]),l[u].includes(s)||l[u].push(s)}t.forEach(([s,u,v],C)=>{const w=o[s]?o[s].level:0,z=w+1;a(s,w),a(u,z),o[s].children||(o[s].children=[]),o[s].children.push({target:u,value:v}),o[s].outflow+=v,o[u].inflow+=v}),Object.keys(o).forEach((s,u)=>{o[s].color=B.value[u]||B.value[u%B.value.length]||X[u]||X[u%d.length]});for(const s in o)o[s].height=xe(Math.max(o[s].inflow,o[s].outflow)),o[s].name=s;const n={};for(const s in l){let u=0;l[s].forEach((v,C)=>{const w=o[v].height;n[v]={x:parseInt(s,10)*te.value+e.value.style.chart.padding.left,y:u,absoluteY:u,height:w,i:C,color:o[v].color,value:$e(w)},u+=w+ee.value})}const g=[];for(const s in o){let u=n[s].absoluteY;o[s].children&&o[s].children.forEach(({target:v,value:C},w)=>{const z=n[v].y,H=n[s],V=n[v],ne=c(u),ue=c(u+C/o[s].outflow*H.height),re=c(z),ie=c(z+C/o[v].inflow*V.height),Oe={id:ce(),source:s,target:v,path:`M ${c(H.x)+c($.value)} ${ne} L ${c(H.x)+c($.value)} ${ue} L ${c(V.x)} ${ie} L ${c(V.x)} ${re} Z`,value:C,sourceColor:o[s].color,targetColor:o[v].color};g.push(Oe),u+=ue-ne,n[v].y+=ie-re})}return{nodeCoordinates:n,links:g}}const p=f(()=>{const t=Ce(m.dataset);return{nodes:Object.keys(t.nodeCoordinates).map((o,l)=>({...t.nodeCoordinates[o],name:o})),links:t.links}}),Ne=f(()=>_e(p.value.nodes));function _e(t){const o={};for(const l in t){const{x:a,height:n}=t[l];o[a]||(o[a]=0),o[a]+=n+ee.value}return Math.max(...Object.values(o))}const j=f(()=>{const{top:t,right:o,left:l,bottom:a}=e.value.style.chart.padding,n=Y.value.length*te.value;return{height:Ne.value+t+a,width:o+Math.max(...p.value.nodes.map(g=>g.x))+$.value,left:l,top:t,right:n-o,p_top:t,p_bottom:a}});function Te(t){const o={},l={},a=new Set;return Y.value.forEach(([n,g,s])=>{o[n]||(o[n]=[]),l[g]||(l[g]=[]),o[n].push(g),l[g].push(n)}),o[t]&&o[t].forEach(n=>a.add(n)),l[t]&&l[t].forEach(n=>a.add(n)),Array.from(a).concat(t)}const y=b(null),O=b(null);function Pe(t){y.value=Te(t.name),O.value=t.name}function Ie(){y.value=null,O.value=null}const oe=f(()=>p.value.links.map(({source:t,target:o,sourceColor:l,targetColor:a,value:n})=>({source:t,target:o,sourceColor:l,targetColor:a,value:n})));function ae(){tt(()=>{const t=oe.value.map((a,n)=>[[a.source],[a.target],[a.value]]),o=[[e.value.style.chart.title.text],[e.value.style.chart.title.subtitle.text],[[e.value.table.columnNames.source],[e.value.table.columnNames.target],[e.value.table.columnNames.value]]].concat(t),l=He(o);Ve({csvContent:l,title:e.value.style.chart.title.text||"vue-ui-flow"})})}const M=f(()=>{const t=[e.value.table.columnNames.source,e.value.table.columnNames.target,e.value.table.columnNames.value],o=oe.value.map((a,n)=>[{color:a.sourceColor,name:a.source},{color:a.targetColor,name:a.target},ve({p:e.value.style.chart.nodes.labels.prefix,v:a.value,s:e.value.style.chart.nodes.labels.suffix,r:e.value.style.chart.nodes.labels.rounding})]),l={th:{backgroundColor:e.value.table.th.backgroundColor,color:e.value.table.th.color,outline:e.value.table.th.outline},td:{backgroundColor:e.value.table.td.backgroundColor,color:e.value.table.td.color,outline:e.value.table.td.outline},breakpoint:e.value.table.responsiveBreakpoint};return{colNames:[e.value.table.columnNames.source,e.value.table.columnNames.target,e.value.table.columnNames.value],head:t,body:o,config:l}});function Fe(){return p.value}function se(){F.value.showTable=!F.value.showTable}return be({getData:Fe,generateCsv:ae,generateImage:U,generatePdf:J,toggleTable:se}),(t,o)=>(r(),h("div",{ref_key:"flowChart",ref:W,class:me(`vue-ui-flow ${_.value?"vue-data-ui-wrapper-fullscreen":""}`),style:N(`font-family:${e.value.style.fontFamily};width:100%; text-align:center;${e.value.style.chart.title.text?"":"padding-top:36px"};background:${e.value.style.chart.backgroundColor}`),id:`flow_${S.value}`},[e.value.style.chart.title.text?(r(),h("div",ot,[(r(),E(Xe,{key:`title_${K.value}`,config:{title:{cy:"flow-title",...e.value.style.chart.title},subtitle:{cy:"flow-subtitle",...e.value.style.chart.title.subtitle}}},null,8,["config"]))])):T("",!0),e.value.userOptions.show&&L.value?(r(),E(Re,{ref:"details",key:`user_option_${A.value}`,backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color,isPrinting:i(q),isImaging:i(Z),uid:S.value,hasPdf:e.value.userOptions.buttons.pdf,hasXls:e.value.userOptions.buttons.csv,hasImg:e.value.userOptions.buttons.img,hasTable:e.value.userOptions.buttons.table,hasFullscreen:e.value.userOptions.buttons.fullscreen,isFullscreen:_.value,titles:{...e.value.userOptions.buttonTitles},chartElement:W.value,position:e.value.userOptions.position,onToggleFullscreen:we,onGeneratePdf:i(J),onGenerateCsv:ae,onGenerateImage:i(U),onToggleTable:se},Ue({_:2},[t.$slots.optionPdf?{name:"optionPdf",fn:k(()=>[x(t.$slots,"optionPdf",{},void 0,!0)]),key:"0"}:void 0,t.$slots.optionCsv?{name:"optionCsv",fn:k(()=>[x(t.$slots,"optionCsv",{},void 0,!0)]),key:"1"}:void 0,t.$slots.optionImg?{name:"optionImg",fn:k(()=>[x(t.$slots,"optionImg",{},void 0,!0)]),key:"2"}:void 0,t.$slots.optionTable?{name:"optionTable",fn:k(()=>[x(t.$slots,"optionTable",{},void 0,!0)]),key:"3"}:void 0,t.$slots.optionFullscreen?{name:"optionFullscreen",fn:k(({toggleFullscreen:l,isFullscreen:a})=>[x(t.$slots,"optionFullscreen",fe(ge({toggleFullscreen:l,isFullscreen:a})),void 0,!0)]),key:"4"}:void 0]),1032,["backgroundColor","color","isPrinting","isImaging","uid","hasPdf","hasXls","hasImg","hasTable","hasFullscreen","isFullscreen","titles","chartElement","position","onGeneratePdf","onGenerateImage"])):T("",!0),(r(),h("svg",{xmlns:i(Be),viewBox:`0 0 ${j.value.width} ${j.value.height}`,class:me({"vue-data-ui-fullscreen--on":_.value,"vue-data-ui-fulscreen--off":!_.value}),style:N(`max-width:100%; overflow: visible; background:transparent;color:${e.value.style.chart.color}`)},[pe(Qe),G("defs",null,[(r(!0),h(P,null,I(p.value.links,(l,a)=>(r(),h("linearGradient",{id:l.id,x1:"0%",y1:"0%",x2:"100%",y2:"0%"},[G("stop",{offset:"0%","stop-color":l.sourceColor},null,8,nt),G("stop",{offset:"100%","stop-color":l.targetColor},null,8,ut)],8,st))),256))]),(r(!0),h(P,null,I(p.value.links,l=>(r(),h("path",{class:"vue-ui-flow-link",d:l.path,fill:`url(#${l.id})`,stroke:e.value.style.chart.links.stroke,"stroke-width":e.value.style.chart.links.strokeWidth,style:N(`opacity:${O.value?[l.target,l.source].includes(O.value)?1:.3:e.value.style.chart.links.opacity}`)},null,12,rt))),256)),(r(!0),h(P,null,I(p.value.nodes,(l,a)=>(r(),h("rect",{class:"vue-ui-flow-node",x:l.x,y:i(c)(l.absoluteY),height:i(c)(l.height),width:$.value,fill:l.color,stroke:e.value.style.chart.nodes.stroke,"stroke-width":e.value.style.chart.nodes.strokeWidth,onMouseenter:n=>Pe(l),onMouseleave:o[0]||(o[0]=n=>Ie()),style:N(`opacity:${y.value?y.value.includes(l.name)?1:.2:1}`)},null,44,it))),256)),(r(!0),h(P,null,I(p.value.nodes,(l,a)=>(r(),h("text",{x:l.x+$.value/2,y:i(c)(l.absoluteY+l.height/2-e.value.style.chart.nodes.labels.fontSize/4),"font-size":e.value.style.chart.nodes.labels.fontSize,fill:i(de)(l.color),"text-anchor":"middle",style:N(`pointer-events: none; opacity:${y.value?y.value.includes(l.name)?1:0:1}`)},D(e.value.style.chart.nodes.labels.abbreviation.use?i(Ye)({source:l.name,length:e.value.style.chart.nodes.labels.abbreviation.length}):l.name),13,ct))),256)),(r(!0),h(P,null,I(p.value.nodes,(l,a)=>(r(),h("text",{x:l.x+$.value/2,y:i(c)(l.absoluteY+l.height/2+e.value.style.chart.nodes.labels.fontSize),"font-size":e.value.style.chart.nodes.labels.fontSize,fill:i(de)(l.color),"text-anchor":"middle",style:N(`pointer-events: none; opacity:${y.value?y.value.includes(l.name)?1:0:1}`)},D(i(je)(e.value.style.chart.nodes.labels.formatter,l.value,i(ve)({p:e.value.style.chart.nodes.labels.prefix,v:l.value,s:e.value.style.chart.nodes.labels.suffix,r:e.value.style.chart.nodes.labels.rounding}),{datapoint:l,seriesIndex:a})),13,vt))),256)),x(t.$slots,"svg",{svg:j.value},void 0,!0)],14,at)),t.$slots.watermark?(r(),h("div",dt,[x(t.$slots,"watermark",fe(ge({isPrinting:i(q)||i(Z)})),void 0,!0)])):T("",!0),L.value?T("",!0):(r(),E(Ke,{key:3,config:{type:"flow",style:{backgroundColor:e.value.style.chart.backgroundColor}}},null,8,["config"])),L.value?(r(),E(Ae,{key:4,hideDetails:"",config:{open:F.value.showTable,maxHeight:1e4,body:{backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color},head:{backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color}}},{content:k(()=>[pe(We,{colNames:M.value.colNames,head:M.value.head,body:M.value.body,config:M.value.config,title:`${e.value.style.chart.title.text}${e.value.style.chart.title.subtitle.text?` : ${e.value.style.chart.title.subtitle.text}`:""}`,onClose:o[1]||(o[1]=l=>F.value.showTable=!1)},{th:k(({th:l})=>[G("div",{innerHTML:l,style:{display:"flex","align-items":"center"}},null,8,ht)]),td:k(({td:l})=>[et(D(l.name||l),1)]),_:1},8,["colNames","head","body","config","title"])]),_:1},8,["config"])):T("",!0)],14,lt))}},_t=qe(ft,[["__scopeId","data-v-53bf76e7"]]);export{_t as default};
