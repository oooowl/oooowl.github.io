import{o as _,f as P,h as U}from"../chart.md.hi_nZSnT.js";import K from"./html2canvas.esm-d2sM-0Wm.tnAx6l3B.js";import{p as i,h as N,o as Q,c as q,P as G}from"./framework.BaNfDZ-f.js";const te={__name:"vue-ui-screenshot",props:{config:{type:Object,default(){return{}}}},emits:["postImage"],setup(R,{expose:X,emit:T}){const k=R,{vue_ui_screenshot:B}=_(),$=i(`vue-ui-screenshot-${Math.random()}`),l=N(()=>{if(!Object.keys(k.config||{}).length)return B;const e=P({defaultConfig:B,userConfig:k.config});return U(e)}),a=i(null),d=i(null),v=i(null),C=i(null),M=i(null),h=i(null),y=i(null),p=i(null),m=i(null),b=i(null),w=i(null),x=i(!1),S=i(null);function Y(){const e=document.createElement("DIV"),{innerWidth:t,innerHeight:n}=window;return e.style.position="fixed",e.style.top=`${n?n/2-l.value.style.captureArea.initialHeight/2:200}px`,e.style.left=`${t?t/2-l.value.style.captureArea.initialWidth/2:100}px`,e.style.width=`${l.value.style.captureArea.initialWidth}px`,e.style.height=`${l.value.style.captureArea.initialHeight}px`,e.style.background=l.value.style.captureArea.background,e.style.cursor="move",e.style.boxSizing="border-box",e.style.border=l.value.style.captureArea.border,e.style.resize="both",e.style.padding="none !important",e.style.margin="none !important",e.dataset.cy="screenshot-overlay",e}function E(){a.value&&(clearTimeout(S.value),a.value.remove(),a.value=null)}function W(e){const t=document.createElement("DIV");t.classList.add("vue-ui-screenshot-info-text"),t.innerHTML=l.value.translations.info,t.dataset.html2canvasIgnore="true",t.dataset.cy="screenshot-info-text",t.style.background=l.value.style.info.background,t.style.color=l.value.style.info.color,t.style.fontWeight=l.value.style.info.bold?"bold":"normal",t.style.minWidth=`${l.value.style.info.minWidth}px`,t.style.left="50%",t.style.padding=`${l.value.style.info.padding}px`,t.style.position="absolute",t.style.textAlign="center",t.style.top=`${l.value.style.info.top}px`,t.style.transform="translateX(-50%)",t.style.borderRadius=`${l.value.style.info.borderRadius}px`,t.style.boxShadow=l.value.style.info.boxShadow,t.style.fontFamily=l.value.style.info.fontFamily,t.style.fontSize=`${l.value.style.info.fontSize}px`,t.style.border=l.value.style.info.border,t.style.userSelect="none";const n=document.createElement("BUTTON");n.classList.add("vue-ui-screenshot-close-button"),n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6l-12 12" /><path d="M6 6l12 12" /></svg>',n.style.outline="none",n.dataset.cy="screenshot-close-button",n.style.display="flex",n.style.cursor="pointer",n.style.borderRadius="50%",n.style.alignItems="center",n.style.position="absolute",n.style.justifyContent="center",n.style.transformOrigin="center",n.style.top=`${l.value.style.cancelButton.top}px`,n.style.right=`${l.value.style.cancelButton.right}px`,n.style.background=l.value.style.cancelButton.background,n.style.color=l.value.style.cancelButton.color,n.style.border=l.value.style.cancelButton.border,n.style.borderRadius=`${l.value.style.cancelButton.borderRadius}px`,n.style.height=`${l.value.style.cancelButton.size}px`,n.style.width=`${l.value.style.cancelButton.size}px`,n.addEventListener("click",E),t.appendChild(n),e.appendChild(t)}function z(e){a.value&&(x.value=!0,e.touches?(h.value=e.touches[0].clientX,y.value=e.touches[0].clientY):(h.value=e.clientX,y.value=e.clientY),b.value=a.value.getBoundingClientRect().width,w.value=a.value.getBoundingClientRect().height,e.target.addEventListener("mousemove",L),e.target.addEventListener("touchmove",L))}function L(e){if(!a.value)return;let t,n;e.touches?(p.value=e.touches[0].clientX,t=e.touches[0].clientX,m.value=e.touches[0].clientY,n=e.touches[0].clientY):(p.value=e.clientX,t=e.clientX,m.value=e.clientY,n=e.clientY);const u=e.target.classList[0],s=a.value.style;switch(!0){case u==="vue-ui-screenshot-handle-nw":s.top=`${n}px`,s.left=`${t}px`,s.width=`${b.value+(h.value-p.value)}px`,s.height=`${w.value+(y.value-m.value)}px`;break;case u==="vue-ui-screenshot-handle-ne":s.top=`${n}px`,s.width=`${b.value+(p.value-h.value)}px`,s.height=`${w.value+(y.value-m.value)}px`;break;case u==="vue-ui-screenshot-handle-sw":s.left=`${t}px`,s.width=`${b.value+(h.value-p.value)}px`,s.height=`${w.value+(m.value-y.value)}px`;break;case u==="vue-ui-screenshot-handle-se":s.width=`${b.value+(p.value-h.value)}px`,s.height=`${w.value+(m.value-y.value)}px`;break}}function A(e){if(!a.value)return;e.stopPropagation();const t=Array.from(e.target.classList);t.includes("vue-ui-screenshot-handle-se")||t.includes("vue-ui-screenshot-handle-sw")||t.includes("vue-ui-screenshot-handle-nw")||t.includes("vue-ui-screenshot-handle-ne")||(x.value=!0,a.value.style.pointerEvents="auto",e.touches?(d.value=e.touches[0].clientX,v.value=e.touches[0].clientY):(d.value=e.clientX,v.value=e.clientY),C.value=d.value,M.value=v.value,document.addEventListener("mousemove",f),document.addEventListener("touchmove",f),document.addEventListener("mouseup",g),document.addEventListener("touchend",g))}function g(){d.value=null,v.value=null,C.value=null,M.value=null,x.value=!1,document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",g),document.removeEventListener("touchmove",f),document.removeEventListener("touchend",g)}function f(e){if(!a.value)return;const t=a.value.getBoundingClientRect();let n,u;e.touches?(n=e.touches[0].clientX-d.value,u=e.touches[0].clientY-v.value,d.value=e.touches[0].clientX,v.value=e.touches[0].clientY):(n=e.clientX-d.value,u=e.clientY-v.value,d.value=e.clientX,v.value=e.clientY),a.value.style.top=`${t.top+u}px`,a.value.style.left=`${t.left+n}px`}function I(e){e.target.removeEventListener("mousemove",L),e.target.removeEventListener("touchmove",L),document.removeEventListener("mousemove",f),document.removeEventListener("touchmove",f),document.removeEventListener("mouseup",g),document.removeEventListener("touchend",g),x.value=!1}function D(){const e=navigator.userAgent;return/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(e)?"tablet":/Mobile|iP(hone|od)|Android|BlackBerry|IEMobile|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(e)?"mobile":"desktop"}function H(){const e=document.getElementById(`vue-ui-screenshot-button-${$.value}`);e.innerHTML=`<svg id="saveButtonSvg" xmlns="http://www.w3.org/2000/svg"  width="24" height="24" viewBox="0 0 20 20" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
    <path fill="none" stroke="currentColor" d="M1 4 1 3C1 2 2 1 3 1L4 1M16 1 17 1C18 1 19 2 19 3L19 4M1 16 1 17C1 18 2 19 3 19L4 19M16 19 17 19C18 19 19 18 19 17L19 16M8 10A1 1 0 0012 10 1 1 0 008 10M5 13 5 8C5 7 5 7 6 7L14 7C15 7 15 7 15 8L15 13C15 14 15 14 14 14L6 14C5 14 5 14 5 13M7 6 13 6" />
    </svg>`,document.getElementById(`vue-ui-screenshot-button-${$.value}`).animate([{opacity:"0.3"},{opacity:"1"},{opacity:"0.3"}],{duration:1e3,iterations:1/0}),e.classList.add("loading"),e.setAttribute("disabled","true")}function O(){if(!a.value)return;H();const e=a.value.getBoundingClientRect();S.value=setTimeout(()=>{K(document.body,{allowTaint:!0,width:e.width,height:e.height,x:e.left+window.scrollX,y:e.top+window.scrollY,useCORS:!0,scale:l.value.quality}).then(t=>{const n=t.toDataURL("image/png",1),u=n.split(",")[1],s=atob(u).length/1024;if(l.value.mode==="download"){const r=document.createElement("a");r.download="screenshot.png",r.href=n,r.click()}l.value.mode==="post"&&T("postImage",{createdAt:Date.now(),fileSize:`${s.toFixed(2)} KB`,image:n,x:e.left+window.scrollX,y:e.top+window.scrollY,screenWidth:window.innerWidth>0?window.innerWidth:screen.width,deviceType:D()})}).finally(E)},10)}function j(e){const t=l.value.style.handles.size/2+4,n=document.createElement("DIV");n.style.top=`${-t}px`,n.style.left=`${-t}px`,n.style.cursor="nw-resize",n.classList.add("vue-ui-screenshot-handle-nw"),n.dataset.cy="screenshot-handle-nw";const u=document.createElement("DIV");u.style.top=`${-t}px`,u.style.left="auto",u.style.right=`${-t}px`,u.style.cursor="ne-resize",u.classList.add("vue-ui-screenshot-handle-ne"),u.dataset.cy="screenshot-handle-ne";const s=document.createElement("DIV");s.style.top="auto",s.style.bottom=`${-t}px`,s.style.left=`${-t}px`,s.style.cursor="sw-resize",s.classList.add("vue-ui-screenshot-handle-sw"),s.dataset.cy="screenshot-handle-sw";const r=document.createElement("DIV");r.style.top="auto",r.style.left="auto",r.style.right=`${-t}px`,r.style.bottom=`${-t}px`,r.style.cursor="se-resize",r.classList.add("vue-ui-screenshot-handle-se"),r.dataset.cy="screenshot-handle-se";const o=document.createElement("BUTTON");o.innerHTML=`<svg id="saveButtonSvg" xmlns="http://www.w3.org/2000/svg"  width="24" height="24" viewBox="0 0 20 20" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path fill="none" stroke="currentColor" d="M1 4 1 3C1 2 2 1 3 1L4 1M16 1 17 1C18 1 19 2 19 3L19 4M1 16 1 17C1 18 2 19 3 19L4 19M16 19 17 19C18 19 19 18 19 17L19 16M8 10A1 1 0 0012 10 1 1 0 008 10M5 13 5 8C5 7 5 7 6 7L14 7C15 7 15 7 15 8L15 13C15 14 15 14 14 14L6 14C5 14 5 14 5 13M7 6 13 6" /></svg><span>${l.value.translations.captureButton}</span>`,o.classList.add("vue-ui-screenshot-capture-button"),o.id=`vue-ui-screenshot-button-${$.value}`,o.style.position="absolute",o.style.top="50%",o.style.left="50%",o.style.transform="translate(-50%,-50%)",o.style.background=l.value.style.captureButton.background,o.style.color=l.value.style.captureButton.color,o.style.border=l.value.style.captureButton.border,o.style.outline="none",o.style.cursor="pointer",o.style.padding=l.value.style.captureButton.padding,o.style.fontFamily=l.value.style.captureButton.fontFamily,o.style.fontSize=`${l.value.style.captureButton.fontSize}px`,o.style.minHeight=`${l.value.style.captureButton.minHeight}px`,o.style.width="fit-content",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.style.gap="3px",o.style.borderRadius=`${l.value.style.captureButton.borderRadius}px`,o.style.boxShadow=l.value.style.captureButton.boxShadow,o.style.userSelect="none",o.style.opacity="0.95",o.style.textAlign="left",o.style.fontWeight=l.value.style.captureButton.bold?"bold":"normal",o.dataset.cy="screenshot-save-button",o.addEventListener("mouseenter",()=>{o.style.opacity="1"}),o.addEventListener("mouseleave",()=>{o.style.opacity="0.95"}),o.addEventListener("click",O),e.appendChild(o),[n,u,s,r].forEach((c,V)=>{c.classList.add(`handle-${V}`),c.dataset.html2canvasIgnore="true",c.style.position="absolute",c.style.height=`${l.value.style.handles.size}px`,c.style.width=`${l.value.style.handles.size}px`,c.style.background=l.value.style.handles.background,c.style.border=l.value.style.handles.border,c.style.borderRadius=`${l.value.style.handles.borderRadius}px`,c.style.pointerEvents="auto !important",c.addEventListener("mousedown",z),c.addEventListener("touchstart",z),e.appendChild(c)})}function F(){a.value||G(()=>{const e=Y();e.dataset.html2canvasIgnore=!0,W(e),j(e),a.value=e,e.addEventListener("touchmove",function(t){t.preventDefault()},{passive:!1}),document.body.appendChild(e),document.addEventListener("mousedown",A),document.addEventListener("touchstart",A),document.addEventListener("mouseup",I),document.addEventListener("touchend",I)})}return X({shoot:F,close:E}),(e,t)=>(Q(),q("div"))}};export{te as default};
