import{o as Oe,L as de,G as Se,R as Ve,e as C,X as Me,K as Y,q as ze,a as Be,m as Ge,j as pe,b as T,Q as Re,c as Ae,p as We,k as U,n as ge,H as Ee,$ as He,N as je,O as qe}from"../chart.md.hi_nZSnT.js";import{O as Ye,M as Ue}from"./useResponsive-NZB-WLRF.DbXjWqi_.js";import{x as Xe}from"./Title-DYNLqCCT.D6xZGHSM.js";import{s as De,i as Ke}from"./usePrinter-8ofTb2MJ.pt_J2AaR.js";import{E as Qe}from"./Tooltip-CICAYyQj.DC7pN5Ho.js";import{W as Je}from"./DataTable-DL2agEJ3.DwhyhpBD.js";import{C as Ze}from"./Legend-DXLiSLHd.5wpQgPWV.js";import et from"./vue-ui-skeleton-B2sRnIXX.C3JvNOY7.js";import tt from"./vue-ui-accordion-D_1fE5EF.ggAyum2g.js";import{c as he}from"./useNestedProp-S1UXxUgm.CErBICdk.js";import{p as lt}from"./PackageVersion-DtnhR89q.DeJ10Meb.js";import{s as at}from"./vue-data-ui-Cp7bO_tj.DKBrIOIj.js";import{p as u,h as d,q as ot,v as st,Y as ut,o as i,c as f,b as _,e as N,aj as rt,w as g,r as y,ak as R,al as A,k as n,n as W,N as S,G as ye,j as k,F as me,C as fe,a as be,t as E,P as it}from"./framework.BaNfDZ-f.js";import"./Shape-CO_Ak9Zm.UkrUmJI7.js";const nt=["id"],vt=["xmlns","viewBox"],ct=["id"],dt=["stop-color"],pt=["stop-color"],gt=["stroke","cx","cy","r","fill"],ht=["stroke","stroke-width","cx","cy","r","fill"],yt=["cx","cy","r","onMouseenter"],mt={key:3,class:"vue-data-ui-watermark"},ft=["onClick"],bt={key:0},kt={key:1},$t=["innerHTML"],wt={__name:"vue-ui-rings",props:{config:{type:Object,default(){return{}}},dataset:{type:Array,default(){return[]}}},emits:["selectLegend"],setup(ke,{expose:$e,emit:we}){const h=ke,{vue_ui_rings:xe}=Oe(),P=u(!1),V=d(()=>!!h.dataset&&h.dataset.length),I=u(de()),Ce=u(null),M=u(!1),H=u(""),x=u(null),X=u(0),L=u(null),D=u(null),K=u(null),Q=u(0),J=u(0),Z=u(0),e=d({get:()=>ee(),set:t=>t});function ee(){const t=he({userConfig:h.config,defaultConfig:xe});return t.theme?{...he({userConfig:Se.vue_ui_rings[t.theme]||h.config,defaultConfig:t}),customPalette:Ve[t.theme]||C}:t}ot(()=>h.config,t=>{e.value=ee(),te(),Q.value+=1,J.value+=1,Z.value+=1},{deep:!0});const z=u(null);st(()=>{te()});function te(){if(Me(h.dataset)?Y({componentName:"VueUiRings",type:"dataset"}):h.dataset.forEach((t,a)=>{t.values.length||Y({componentName:"VueUiRings",type:"dataset"}),ze({datasetObject:t,requiredAttributes:["name","values"]}).forEach(l=>{Y({componentName:"VueUiRings",type:"datasetSerieAttribute",property:l,index:a})})}),e.value.responsive){const t=Ye(()=>{const{width:a,height:l}=Ue({chart:L.value,title:e.value.style.chart.title.text?D.value:null,legend:e.value.style.chart.legend.show?K.value:null});r.value.width=a,r.value.height=l});z.value=new ResizeObserver(t),z.value.observe(L.value.parentNode)}setTimeout(()=>{P.value=!0},600)}ut(()=>{z.value&&z.value.disconnect()});const{isPrinting:le,isImaging:ae,generatePdf:oe,generateImage:se}=De({elementId:`rings_${I.value}`,fileName:e.value.style.chart.title.text||"vue-ui-rings"}),ue=d(()=>Be(e.value.customPalette)),$=u({showTable:e.value.table.show,showTooltip:e.value.style.chart.tooltip.show}),r=u({height:360,width:360}),Te=d(()=>Math.min(r.value.height,r.value.width)),v=u([]);function j(t){v.value.includes(t)?v.value=v.value.filter(a=>a!==t):v.value.push(t),we("selectLegend",c.value.map(a=>({name:a.name,color:a.color,value:a.value})))}const _e=d(()=>Math.max(...B.value.filter(t=>!v.value.includes(t.uid)).map(({value:t})=>t)));function re(t){return t/_e.value}const B=d(()=>h.dataset.map(({values:t,name:a,color:l=null},o)=>{const s=Ge(t).reduce((b,O)=>b+O,0);return{name:a,color:l||pe(l)||ue.value[o]||C[o]||C[o%C.length],value:s,proportion:s/h.dataset.map(b=>(b.values||[]).reduce((O,Fe)=>O+Fe,0)).reduce((b,O)=>b+O,0),uid:de()}})),ie=d(()=>B.value.map(t=>({...t,shape:"circle",opacity:v.value.includes(t.uid)?.5:1,segregate:()=>j(t.uid),isSegregated:v.value.includes(t.uid)})).toSorted((t,a)=>a.value-t.value)),Ne=d(()=>({cy:"rings-div-legend",backgroundColor:e.value.style.chart.legend.backgroundColor,color:e.value.style.chart.legend.color,fontSize:e.value.style.chart.legend.fontSize,paddingBottom:12,fontWeight:e.value.style.chart.legend.bold?"bold":""})),m=d(()=>B.value.filter(t=>!v.value.includes(t.uid)).map(({value:t})=>t).reduce((t,a)=>t+a,0)),c=d(()=>B.value.filter(t=>!v.value.includes(t.uid)).map(({name:t,value:a,color:l=null,uid:o},s)=>({uid:o,name:t,color:l||pe(l)||ue.value[s]||C[s]||C[s%C.length],value:a,proportion:re(a),percentage:a/m.value*100,strokeWidth:e.value.style.chart.layout.rings.strokeWidth*re(a)})).toSorted((t,a)=>a.value-t.value));function Pe(){return c.value.map(({name:t,color:a,value:l,absoluteValues:o,percentage:s})=>({name:t,color:a,value:l,absoluteValues:o,percentage:s}))}const p=d(()=>Te.value-e.value.style.chart.layout.rings.strokeWidth*2),q=u(null);function Ie(t,a){if(v.value.length===h.dataset.length)return;q.value={datapoint:a,seriesIndex:t,series:c.value,config:e.value},x.value=t;const l=c.value[t],o=e.value.style.chart.tooltip.customFormat;if(Ee(o)&&He(()=>o({seriesIndex:t,datapoint:a,series:c.value,config:e.value})))H.value=o({seriesIndex:t,datapoint:a,series:c.value,config:e.value});else{let s="";s+=`<div style="width:100%;text-align:center;border-bottom:1px solid ${e.value.style.chart.tooltip.borderColor};padding-bottom:6px;margin-bottom:3px;">${l.name}</div>`,s+=`<div style="display:flex;flex-direction:row;gap:6px;align-items:center;"><svg viewBox="0 0 12 12" height="14" width="14"><circle cx="6" cy="6" r="6" stroke="none" fill="${l.color}" /></svg>`,e.value.style.chart.tooltip.showValue&&(s+=`<b>${ge(e.value.style.chart.layout.labels.dataLabels.formatter,l.value,T({p:e.value.style.chart.layout.labels.dataLabels.prefix,v:l.value,s:e.value.style.chart.layout.labels.dataLabels.suffix,r:e.value.style.chart.tooltip.roundingValue}),{datapoint:a,seriesIndex:t})}
      </b>`),e.value.style.chart.tooltip.showPercentage&&(e.value.style.chart.tooltip.showValue?s+=`<span>(${T({v:l.value/m.value*100,s:"%",r:e.value.style.chart.tooltip.roundingPercentage})})</span></div>`:s+=`<b>${T({v:l.value/m.value*100,s:"%",r:e.value.style.chart.tooltip.roundingPercentage})}</b></div>`),H.value=s}M.value=!0}const w=d(()=>{const t=c.value.map(l=>({name:l.name,color:l.color})),a=c.value.map(l=>l.value);return{head:t,body:a}}),G=d(()=>{const t=[' <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 16v2a1 1 0 0 1 -1 1h-11l6 -7l-6 -7h11a1 1 0 0 1 1 1v2" /></svg>',T({p:e.value.style.chart.layout.labels.dataLabels.prefix,v:m.value,s:e.value.style.chart.layout.labels.dataLabels.suffix,r:e.value.table.td.roundingValue}),"100%"],a=w.value.head.map((s,b)=>[{color:s.color,name:s.name},T({p:e.value.style.chart.layout.labels.dataLabels.prefix,v:w.value.body[b],s:e.value.style.chart.layout.labels.dataLabels.suffix,r:e.value.table.td.roundingValue}),isNaN(w.value.body[b]/m.value)?"-":(w.value.body[b]/m.value*100).toFixed(e.value.table.td.roundingPercentage)+"%"]),l={th:{backgroundColor:e.value.table.th.backgroundColor,color:e.value.table.th.color,outline:e.value.table.th.outline},td:{backgroundColor:e.value.table.td.backgroundColor,color:e.value.table.td.color,outline:e.value.table.td.outline},breakpoint:e.value.table.responsiveBreakpoint},o=[e.value.table.columnNames.series,e.value.table.columnNames.value,e.value.table.columnNames.percentage];return{head:t,body:a,config:l,colNames:o}});function ne(){it(()=>{const t=w.value.head.map((o,s)=>[[o.name],[w.value.body[s]],[isNaN(w.value.body[s]/m.value)?"-":w.value.body[s]/m.value*100]]),a=[[e.value.style.chart.title.text],[e.value.style.chart.title.subtitle.text],[[""],["val"],["%"]]].concat(t),l=je(a);qe({csvContent:l,title:e.value.style.chart.title.text||"vue-ui-rings"})})}const F=u(!1);function Le(t){F.value=t,X.value+=1}function ve(){$.value.showTable=!$.value.showTable}function ce(){$.value.showTooltip=!$.value.showTooltip}return $e({getData:Pe,generatePdf:oe,generateCsv:ne,generateImage:se,toggleTable:ve,toggleTooltip:ce}),(t,a)=>(i(),f("div",{ref_key:"ringsChart",ref:L,class:W(`vue-ui-rings ${F.value?"vue-data-ui-wrapper-fullscreen":""} ${e.value.useCssAnimation?"":"vue-ui-dna"}`),style:S(`font-family:${e.value.style.fontFamily};text-align:center;width:100%;background:${e.value.style.chart.backgroundColor};${e.value.responsive?"height: 100%":""}`),id:`rings_${I.value}`,onMouseleave:a[3]||(a[3]=l=>{x.value=null,M.value=!1})},[e.value.style.chart.title.text?(i(),f("div",{key:0,ref_key:"chartTitle",ref:D,style:"width:100%;background:transparent"},[(i(),_(Xe,{key:`title_${Q.value}`,config:{title:{cy:"rings-div-title",...e.value.style.chart.title},subtitle:{cy:"rings-div-subtitle",...e.value.style.chart.title.subtitle}}},null,8,["config"]))],512)):N("",!0),e.value.userOptions.show&&V.value?(i(),_(Ke,{ref_key:"details",ref:Ce,key:`user_options_${X.value}`,backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color,isPrinting:n(le),isImaging:n(ae),uid:I.value,hasTooltip:e.value.userOptions.buttons.tooltip&&e.value.style.chart.tooltip.show,hasPdf:e.value.userOptions.buttons.pdf,hasXls:e.value.userOptions.buttons.csv,hasImg:e.value.userOptions.buttons.img,hasTable:e.value.userOptions.buttons.table,hasFullscreen:e.value.userOptions.buttons.fullscreen,isTooltip:$.value.showTooltip,isFullscreen:F.value,titles:{...e.value.userOptions.buttonTitles},chartElement:L.value,position:e.value.userOptions.position,onToggleFullscreen:Le,onGeneratePdf:n(oe),onGenerateCsv:ne,onGenerateImage:n(se),onToggleTable:ve,onToggleTooltip:ce},rt({_:2},[t.$slots.optionTooltip?{name:"optionTooltip",fn:g(()=>[y(t.$slots,"optionTooltip",{},void 0,!0)]),key:"0"}:void 0,t.$slots.optionPdf?{name:"optionPdf",fn:g(()=>[y(t.$slots,"optionPdf",{},void 0,!0)]),key:"1"}:void 0,t.$slots.optionCsv?{name:"optionCsv",fn:g(()=>[y(t.$slots,"optionCsv",{},void 0,!0)]),key:"2"}:void 0,t.$slots.optionImg?{name:"optionImg",fn:g(()=>[y(t.$slots,"optionImg",{},void 0,!0)]),key:"3"}:void 0,t.$slots.optionTable?{name:"optionTable",fn:g(()=>[y(t.$slots,"optionTable",{},void 0,!0)]),key:"4"}:void 0,t.$slots.optionFullscreen?{name:"optionFullscreen",fn:g(({toggleFullscreen:l,isFullscreen:o})=>[y(t.$slots,"optionFullscreen",R(A({toggleFullscreen:l,isFullscreen:o})),void 0,!0)]),key:"5"}:void 0]),1032,["backgroundColor","color","isPrinting","isImaging","uid","hasTooltip","hasPdf","hasXls","hasImg","hasTable","hasFullscreen","isTooltip","isFullscreen","titles","chartElement","position","onGeneratePdf","onGenerateImage"])):N("",!0),V.value?(i(),f("svg",{key:2,xmlns:n(Re),class:W({"vue-data-ui-fullscreen--on":F.value,"vue-data-ui-fulscreen--off":!F.value}),viewBox:`0 0 ${r.value.width<=0?10:r.value.width} ${r.value.height<=0?10:r.value.height}`,style:S(`max-width:100%;overflow:visible;background:transparent;color:${e.value.style.chart.color}`)},[ye(lt),k("defs",null,[(i(!0),f(me,null,fe(c.value,(l,o)=>(i(),f("radialGradient",{cx:"50%",cy:"30%",r:"50%",fx:"50%",fy:"50%",id:`gradient_${I.value}_${o}`},[k("stop",{offset:"0%","stop-color":n(Ae)(n(We)(l.color,.05),100-e.value.style.chart.layout.rings.gradient.intensity)},null,8,dt),k("stop",{offset:"100%","stop-color":l.color},null,8,pt)],8,ct))),256))]),(i(!0),f(me,null,fe(c.value,(l,o)=>(i(),f("g",null,[k("circle",{class:W({"vue-ui-rings-item":P.value&&e.value.useCssAnimation,"vue-rings-item-onload":!P.value&&e.value.useCssAnimation,"vue-ui-rings-opacity":x.value!==null&&x.value!==o}),style:S(`animation-delay:${o*100}ms`),stroke:e.value.style.chart.layout.rings.stroke,cx:r.value.width/2,cy:o===0?r.value.height/2:r.value.height/2+p.value*c.value[0].proportion/2-p.value*l.proportion/2-2*(o+1),r:n(U)(p.value*l.proportion/2*.9<=0?1e-4:p.value*l.proportion/2*.9),fill:e.value.style.chart.layout.rings.gradient.underlayerColor},null,14,gt),k("circle",{class:W({"vue-ui-rings-item":P.value&&e.value.useCssAnimation,"vue-rings-item-onload":!P.value&&e.value.useCssAnimation,"vue-ui-rings-shadow":e.value.style.chart.layout.rings.useShadow,"vue-ui-rings-blur":x.value!==null&&x.value!==o}),style:S(`animation-delay:${o*100}ms`),stroke:e.value.style.chart.layout.rings.stroke,"stroke-width":l.strokeWidth<.5?.5:l.strokeWidth,cx:r.value.width/2,cy:o===0?r.value.height/2:r.value.height/2+p.value*c.value[0].proportion/2-p.value*l.proportion/2-2*(o+1),r:n(U)(p.value*l.proportion/2*.9<=0?1e-4:p.value*l.proportion/2*.9),fill:e.value.style.chart.layout.rings.gradient.show?`url(#gradient_${I.value}_${o})`:l.color},null,14,ht),k("circle",{"data-cy-trap":"",stroke:"none",cx:r.value.width/2,cy:o===0?r.value.height/2:r.value.height/2+p.value*c.value[0].proportion/2-p.value*l.proportion/2-2*(o+1),r:n(U)(p.value*l.proportion/2*.9<=0?1e-4:p.value*l.proportion/2*.9),fill:"transparent",onMouseenter:s=>Ie(o,l),onMouseleave:a[0]||(a[0]=s=>{x.value=null,M.value=!1})},null,40,yt)]))),256)),y(t.$slots,"svg",{svg:r.value},void 0,!0)],14,vt)):N("",!0),t.$slots.watermark?(i(),f("div",mt,[y(t.$slots,"watermark",R(A({isPrinting:n(le)||n(ae)})),void 0,!0)])):N("",!0),V.value?N("",!0):(i(),_(et,{key:4,config:{type:"rings",style:{backgroundColor:e.value.style.chart.backgroundColor,rings:{color:"#CCCCCC"}}}},null,8,["config"])),k("div",{ref_key:"chartLegend",ref:K},[e.value.style.chart.legend.show?(i(),_(Ze,{key:`legend_${Z.value}`,legendSet:ie.value,config:Ne.value,onClickMarker:a[1]||(a[1]=({legend:l})=>j(l.uid))},{item:g(({legend:l,index:o})=>[k("div",{"data-cy-legend-item":"",onClick:s=>j(l.uid),style:S(`opacity:${v.value.includes(l.uid)?.5:1}`)},[be(E(l.name)+": "+E(n(ge)(e.value.style.chart.layout.labels.dataLabels.formatter,l.value,n(T)({p:e.value.style.chart.layout.labels.dataLabels.prefix,v:l.value,s:e.value.style.chart.layout.labels.dataLabels.suffix,r:e.value.style.chart.legend.roundingValue}),{datapoint:l,seriesIndex:o}))+" ",1),v.value.includes(l.uid)?(i(),f("span",kt," ( - % ) ")):(i(),f("span",bt," ("+E(isNaN(l.value/m.value)?"-":n(T)({v:l.value/m.value*100,s:"%",r:e.value.style.chart.legend.roundingPercentage}))+") ",1))],12,ft)]),_:1},8,["legendSet","config"])):y(t.$slots,"legend",{key:1,legend:ie.value},void 0,!0)],512),ye(Qe,{show:$.value.showTooltip&&M.value&&v.value.length<h.dataset.length,backgroundColor:e.value.style.chart.tooltip.backgroundColor,color:e.value.style.chart.tooltip.color,borderRadius:e.value.style.chart.tooltip.borderRadius,borderColor:e.value.style.chart.tooltip.borderColor,borderWidth:e.value.style.chart.tooltip.borderWidth,fontSize:e.value.style.chart.tooltip.fontSize,backgroundOpacity:e.value.style.chart.tooltip.backgroundOpacity,position:e.value.style.chart.tooltip.position,offsetY:e.value.style.chart.tooltip.offsetY,parent:L.value,content:H.value,isCustom:e.value.style.chart.tooltip.customFormat&&typeof e.value.style.chart.tooltip.customFormat=="function"},{"tooltip-before":g(()=>[y(t.$slots,"tooltip-before",R(A({...q.value})),void 0,!0)]),"tooltip-after":g(()=>[y(t.$slots,"tooltip-after",R(A({...q.value})),void 0,!0)]),_:3},8,["show","backgroundColor","color","borderRadius","borderColor","borderWidth","fontSize","backgroundOpacity","position","offsetY","parent","content","isCustom"]),V.value?(i(),_(tt,{key:5,hideDetails:"",config:{open:$.value.showTable,maxHeight:1e4,body:{backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color},head:{backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color}}},{content:g(()=>[(i(),_(Je,{key:`table_${J.value}`,colNames:G.value.colNames,head:G.value.head,body:G.value.body,config:G.value.config,title:`${e.value.style.chart.title.text}${e.value.style.chart.title.subtitle.text?` : ${e.value.style.chart.title.subtitle.text}`:""}`,onClose:a[2]||(a[2]=l=>$.value.showTable=!1)},{th:g(({th:l})=>[k("div",{innerHTML:l,style:{display:"flex","align-items":"center"}},null,8,$t)]),td:g(({td:l})=>[be(E(l.name||l),1)]),_:1},8,["colNames","head","body","config","title"]))]),_:1},8,["config"])):N("",!0)],46,nt))}},Bt=at(wt,[["__scopeId","data-v-08656179"]]);export{Bt as default};
