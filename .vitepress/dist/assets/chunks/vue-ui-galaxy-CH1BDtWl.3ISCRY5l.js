import{o as $e,X as Te,K as oe,q as _e,L as se,G as Ie,R as Ne,e as L,a as Pe,j as Le,m as re,s as Oe,b as k,Q as Fe,n as ue,H as ie,$ as Se,N as Be,O as Ge}from"../chart.md.hi_nZSnT.js";import{C as Ve}from"./Legend-DXLiSLHd.5wpQgPWV.js";import{x as Ee}from"./Title-DYNLqCCT.D6xZGHSM.js";import{E as We}from"./Tooltip-CICAYyQj.DC7pN5Ho.js";import{W as ze}from"./DataTable-DL2agEJ3.DwhyhpBD.js";import{s as Me,i as He}from"./usePrinter-8ofTb2MJ.pt_J2AaR.js";import je from"./vue-ui-skeleton-B2sRnIXX.C3JvNOY7.js";import De from"./vue-ui-accordion-D_1fE5EF.ggAyum2g.js";import{c as ne}from"./useNestedProp-S1UXxUgm.CErBICdk.js";import{p as Re}from"./PackageVersion-DtnhR89q.DeJ10Meb.js";import{s as Xe}from"./vue-data-ui-Cp7bO_tj.DKBrIOIj.js";import{h as c,v as Ye,p as u,q as qe,o as r,c as i,b as w,e as d,aj as Ke,w as n,r as h,ak as O,al as F,k as p,n as S,N as H,G as ve,j as C,F as ce,C as de,a as he,t as B,P as Qe}from"./framework.BaNfDZ-f.js";import"./Shape-CO_Ak9Zm.UkrUmJI7.js";const Ae=["id"],Ue={key:0,style:"width:100%;background:transparent;padding-bottom:24px"},Ze=["xmlns","viewBox"],Je=["id"],et=["stdDeviation"],tt=["d","stroke","stroke-width"],at=["d","stroke","stroke-width"],lt=["filter"],ot=["d","stroke","stroke-width"],st=["d","stroke-width","onMouseenter","onClick"],rt={key:3,class:"vue-data-ui-watermark"},ut=["onClick"],it={key:0},nt={key:1},vt=["innerHTML"],ct={__name:"vue-ui-galaxy",props:{config:{type:Object,default(){return{}}},dataset:{type:Array,default(){return[]}}},emits:["selectLegend","selectDatapoint"],setup(pe,{expose:ye,emit:j}){const y=pe,{vue_ui_galaxy:ge}=$e(),N=c(()=>!!y.dataset&&y.dataset.length);Ye(()=>{D()});function D(){Te(y.dataset)?oe({componentName:"VueUiGalaxy",type:"dataset"}):y.dataset.forEach((t,l)=>{_e({datasetObject:t,requiredAttributes:["name","values"]}).forEach(a=>{oe({componentName:"VueUiGalaxy",type:"datasetSerieAttribute",property:a,index:l})})})}const $=u(se()),G=u(null),fe=u(null),V=u(!1),E=u(""),g=u(null),R=u(0),X=u(0),Y=u(0),q=u(0),e=c({get:()=>K(),set:t=>t});function K(){const t=ne({userConfig:y.config,defaultConfig:ge});return t.theme?{...ne({userConfig:Ie.vue_ui_galaxy[t.theme]||y.config,defaultConfig:t}),customPalette:Ne[t.theme]||L}:t}qe(()=>y.config,t=>{e.value=K(),D(),X.value+=1,Y.value+=1,q.value+=1},{deep:!0});const{isPrinting:Q,isImaging:A,generatePdf:U,generateImage:Z}=Me({elementId:`galaxy_${$.value}`,fileName:e.value.style.chart.title.text||"vue-ui-galaxy"}),be=c(()=>Pe(e.value.customPalette)),b=u({dataLabels:{show:e.value.style.chart.layout.labels.dataLabels.show},showTable:e.value.table.show,showTooltip:e.value.style.chart.tooltip.show}),W=u({height:180,width:250}),v=u([]);function z(t){v.value.includes(t.id)?v.value=v.value.filter(l=>l!==t.id):v.value.push(t.id),j("selectLegend",T.value.map(l=>({name:l.name,color:l.color,value:l.value})))}const x=c(()=>y.dataset.map((t,l)=>({name:t.name,color:Le(t.color)||be.value[l]||L[l]||L[l%L.length],value:t.values?re(t.values).reduce((a,o)=>a+o,0):0,absoluteValues:re(t.values),id:se(),seriesIndex:l})).sort((t,l)=>l.value-t.value));function me(){return x.value.map(t=>({name:t.name,color:t.color,value:t.value}))}const f=c(()=>x.value.filter(t=>!v.value.includes(t.id)).map(t=>t.value).reduce((t,l)=>t+l,0)),ke=u(190),J=c(()=>x.value.filter(t=>!v.value.includes(t.id))),T=c(()=>{const t=[];for(let l=0;l<J.value.length;l+=1){const a=J.value[l];let o=a.value/f.value*ke.value;l>0&&t.length&&(o+=t[l-1].points),t.push({points:o,...a,seriesIndex:l,proportion:a.value/f.value,path:Oe({points:o,startX:115+e.value.style.chart.layout.arcs.offsetX,startY:90+e.value.style.chart.layout.arcs.offsetY})})}return t.filter((l,a)=>!v.value.includes(l.id)).toSorted((l,a)=>a.points-l.points)}),_=u(!1);function xe(t){_.value=t,R.value+=1}const M=u(null);function we({datapoint:t,_relativeIndex:l,seriesIndex:a,show:o=!1}){M.value={datapoint:t,seriesIndex:a,series:x.value,config:e.value},V.value=o,g.value=t.id;let s="";const I=e.value.style.chart.tooltip.customFormat;ie(I)&&Se(()=>I({seriesIndex:a,datapoint:t,series:x.value,config:e.value}))?E.value=I({seriesIndex:a,datapoint:t,series:x.value,config:e.value}):(s+=`<div style="width:100%;text-align:center;border-bottom:1px solid ${e.value.style.chart.tooltip.borderColor};padding-bottom:6px;margin-bottom:3px;">${t.name}</div>`,s+=`<div style="display:flex;flex-direction:row;gap:6px;align-items:center;"><svg viewBox="0 0 12 12" height="14" width="14"><circle cx="6" cy="6" r="6" stroke="none" fill="${t.color}"/></svg>`,e.value.style.chart.tooltip.showValue&&(s+=`<b>${ue(e.value.style.chart.layout.labels.dataLabels.formatter,t.value,k({p:e.value.style.chart.layout.labels.dataLabels.prefix,v:t.value,s:e.value.style.chart.layout.labels.dataLabels.suffix,r:e.value.style.chart.tooltip.roundingValue}),{datapoint:t,seriesIndex:a})}</b>`),e.value.style.chart.tooltip.showPercentage&&(e.value.style.chart.tooltip.showValue?s+=`<span>(${k({v:t.proportion*100,s:"%",r:e.value.style.chart.tooltip.roundingPercentage})})</span></div>`:s+=`<b>${k({v:t.proportion*100,s:"%",r:e.value.style.chart.tooltip.roundingPercentage})}</b></div>`),E.value=`<div>${s}</div>`)}const ee=c(()=>x.value.map((t,l)=>({...t,proportion:(t.value||0)/y.dataset.map(a=>(a.values||[]).reduce((o,s)=>o+s,0)).reduce((a,o)=>a+o,0),opacity:v.value.includes(t.id)?.5:1,shape:t.shape||"circle",segregate:()=>z(t),isSegregated:v.value.includes(t.id)}))),Ce=c(()=>({cy:"galaxy-div-legend",backgroundColor:e.value.style.chart.legend.backgroundColor,color:e.value.style.chart.legend.color,fontSize:e.value.style.chart.legend.fontSize,paddingBottom:12,fontWeight:e.value.style.chart.legend.bold?"bold":""})),m=c(()=>{const t=T.value.map(a=>({name:a.name,color:a.color})),l=T.value.map(a=>a.value);return{head:t,body:l}});function te(){Qe(()=>{const t=m.value.head.map((o,s)=>[[o.name],[m.value.body[s]],[isNaN(m.value.body[s]/f.value)?"-":m.value.body[s]/f.value*100]]),l=[[e.value.style.chart.title.text],[e.value.style.chart.title.subtitle.text],[[""],["val"],["%"]]].concat(t),a=Be(l);Ge({csvContent:a,title:e.value.style.chart.title.text||"vue-ui-galaxy"})})}const P=c(()=>{const t=[' <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 16v2a1 1 0 0 1 -1 1h-11l6 -7l-6 -7h11a1 1 0 0 1 1 1v2" /></svg>',k({p:e.value.style.chart.layout.labels.dataLabels.prefix,v:f.value,s:e.value.style.chart.layout.labels.dataLabels.suffix,r:e.value.table.td.roundingValue}),"100%"],l=m.value.head.map((o,s)=>{const I=k({p:e.value.style.chart.layout.labels.dataLabels.prefix,v:m.value.body[s],s:e.value.style.chart.layout.labels.dataLabels.suffix,r:e.value.table.td.roundingValue});return[{color:o.color,name:o.name},I,isNaN(m.value.body[s]/f.value)?"-":k({v:m.value.body[s]/f.value*100,s:"%",r:e.value.table.td.roundingPercentage})]}),a={th:{backgroundColor:e.value.table.th.backgroundColor,color:e.value.table.th.color,outline:e.value.table.th.outline},td:{backgroundColor:e.value.table.td.backgroundColor,color:e.value.table.td.color,outline:e.value.table.td.outline},breakpoint:e.value.table.responsiveBreakpoint};return{colNames:[e.value.table.columnNames.series,e.value.table.columnNames.value,e.value.table.columnNames.percentage],head:t,body:l,config:a}});function ae(){b.value.showTable=!b.value.showTable}function le(){b.value.showTooltip=!b.value.showTooltip}return ye({getData:me,generatePdf:U,generateCsv:te,generateImage:Z,toggleTable:ae,toggleTooltip:le}),(t,l)=>(r(),i("div",{ref_key:"galaxyChart",ref:G,class:S(`vue-ui-galaxy ${_.value?"vue-data-ui-wrapper-fullscreen":""} ${e.value.useCssAnimation?"":"vue-ui-dna"}`),style:H(`font-family:${e.value.style.fontFamily};width:100%; text-align:center;${e.value.style.chart.title.text?"":"padding-top:36px"};background:${e.value.style.chart.backgroundColor}`),id:`galaxy_${$.value}`},[e.value.style.chart.title.text?(r(),i("div",Ue,[(r(),w(Ee,{key:`title_${X.value}`,config:{title:{cy:"galaxy-div-title",...e.value.style.chart.title},subtitle:{cy:"galaxy-div-subtitle",...e.value.style.chart.title.subtitle}}},null,8,["config"]))])):d("",!0),e.value.userOptions.show&&N.value?(r(),w(He,{ref_key:"details",ref:fe,key:`user_option_${R.value}`,backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color,isPrinting:p(Q),isImaging:p(A),uid:$.value,hasTooltip:e.value.userOptions.buttons.tooltip&&e.value.style.chart.tooltip.show,hasPdf:e.value.userOptions.buttons.pdf,hasXls:e.value.userOptions.buttons.csv,hasImg:e.value.userOptions.buttons.img,hasTable:e.value.userOptions.buttons.table,hasFullscreen:e.value.userOptions.buttons.fullscreen,isTooltip:b.value.showTooltip,isFullscreen:_.value,titles:{...e.value.userOptions.buttonTitles},chartElement:G.value,position:e.value.userOptions.position,onToggleFullscreen:xe,onGeneratePdf:p(U),onGenerateCsv:te,onGenerateImage:p(Z),onToggleTable:ae,onToggleTooltip:le},Ke({_:2},[t.$slots.optionTooltip?{name:"optionTooltip",fn:n(()=>[h(t.$slots,"optionTooltip",{},void 0,!0)]),key:"0"}:void 0,t.$slots.optionPdf?{name:"optionPdf",fn:n(()=>[h(t.$slots,"optionPdf",{},void 0,!0)]),key:"1"}:void 0,t.$slots.optionCsv?{name:"optionCsv",fn:n(()=>[h(t.$slots,"optionCsv",{},void 0,!0)]),key:"2"}:void 0,t.$slots.optionImg?{name:"optionImg",fn:n(()=>[h(t.$slots,"optionImg",{},void 0,!0)]),key:"3"}:void 0,t.$slots.optionTable?{name:"optionTable",fn:n(()=>[h(t.$slots,"optionTable",{},void 0,!0)]),key:"4"}:void 0,t.$slots.optionFullscreen?{name:"optionFullscreen",fn:n(({toggleFullscreen:a,isFullscreen:o})=>[h(t.$slots,"optionFullscreen",O(F({toggleFullscreen:a,isFullscreen:o})),void 0,!0)]),key:"5"}:void 0]),1032,["backgroundColor","color","isPrinting","isImaging","uid","hasTooltip","hasPdf","hasXls","hasImg","hasTable","hasFullscreen","isTooltip","isFullscreen","titles","chartElement","position","onGeneratePdf","onGenerateImage"])):d("",!0),N.value?(r(),i("svg",{key:2,xmlns:p(Fe),class:S({"vue-data-ui-fullscreen--on":_.value,"vue-data-ui-fulscreen--off":!_.value}),viewBox:`0 0 ${W.value.width} ${W.value.height}`,style:H(`max-width:100%; overflow: visible; background:transparent;color:${e.value.style.chart.color}`)},[ve(Re),C("defs",null,[C("filter",{id:`blur_${$.value}`,x:"-50%",y:"-50%",width:"200%",height:"200%"},[C("feGaussianBlur",{in:"SourceGraphic",stdDeviation:100/e.value.style.chart.layout.arcs.gradient.intensity},null,8,et)],8,Je)]),(r(!0),i(ce,null,de(T.value,a=>(r(),i("g",null,[a.value?(r(),i("path",{key:0,d:a.path,fill:"none",stroke:e.value.style.chart.backgroundColor,"stroke-width":(e.value.style.chart.layout.arcs.strokeWidth+e.value.style.chart.layout.arcs.borderWidth)*(g.value===a.id&&e.value.style.chart.layout.arcs.hoverEffect.show?e.value.style.chart.layout.arcs.hoverEffect.multiplicator:1),"stroke-linecap":"round"},null,8,tt)):d("",!0),a.value?(r(),i("path",{key:1,d:a.path,fill:"none",stroke:a.color,"stroke-width":e.value.style.chart.layout.arcs.strokeWidth*(g.value===a.id&&e.value.style.chart.layout.arcs.hoverEffect.show?e.value.style.chart.layout.arcs.hoverEffect.multiplicator:1),"stroke-linecap":"round",class:S(`${g.value&&g.value!==a.id&&e.value.useBlurOnHover?"vue-ui-galaxy-blur":""}`)},null,10,at)):d("",!0),a.value&&e.value.style.chart.layout.arcs.gradient.show?(r(),i("g",{key:2,filter:`url(#blur_${$.value})`},[C("path",{d:a.path,fill:"none",stroke:e.value.style.chart.layout.arcs.gradient.color,"stroke-width":e.value.style.chart.layout.arcs.strokeWidth/2*(g.value===a.id&&e.value.style.chart.layout.arcs.hoverEffect.show?e.value.style.chart.layout.arcs.hoverEffect.multiplicator:1),"stroke-linecap":"round",class:S(`vue-ui-galaxy-gradient ${g.value&&g.value!==a.id&&e.value.useBlurOnHover?"vue-ui-galaxy-blur":""}`)},null,10,ot)],8,lt)):d("",!0)]))),256)),(r(!0),i(ce,null,de(T.value,(a,o)=>(r(),i("g",null,[a.value?(r(),i("path",{key:0,d:a.path,fill:"none",stroke:"transparent","stroke-width":e.value.style.chart.layout.arcs.strokeWidth+e.value.style.chart.layout.arcs.borderWidth,"stroke-linecap":"round",onMouseenter:s=>we({datapoint:a,relativeIndex:o,seriesIndex:a.seriesIndex,show:!0}),onMouseleave:l[0]||(l[0]=s=>{V.value=!1,g.value=null}),onClick:s=>j("selectDatapoint",a)},null,40,st)):d("",!0)]))),256)),h(t.$slots,"svg",{svg:W.value},void 0,!0)],14,Ze)):d("",!0),t.$slots.watermark?(r(),i("div",rt,[h(t.$slots,"watermark",O(F({isPrinting:p(Q)||p(A)})),void 0,!0)])):d("",!0),N.value?d("",!0):(r(),w(je,{key:4,config:{type:"galaxy",style:{backgroundColor:e.value.style.chart.backgroundColor,galaxy:{color:"#CCCCCC"}}}},null,8,["config"])),e.value.style.chart.legend.show?(r(),w(Ve,{key:`legend_${q.value}`,legendSet:ee.value,config:Ce.value,onClickMarker:l[1]||(l[1]=({legend:a})=>z(a))},{item:n(({legend:a,index:o})=>[C("div",{onClick:s=>z(a),style:H(`opacity:${v.value.includes(a.id)?.5:1}`)},[he(B(a.name)+": "+B(p(ue)(e.value.style.chart.layout.labels.dataLabels.formatter,a.value,p(k)({p:e.value.style.chart.layout.labels.dataLabels.prefix,v:a.value,s:e.value.style.chart.layout.labels.dataLabels.suffix,r:e.value.style.chart.legend.roundingValue}),{datapoint:a,seriesIndex:o}))+" ",1),v.value.includes(a.id)?(r(),i("span",nt," ( - % ) ")):(r(),i("span",it," ("+B(isNaN(a.value/f.value)?"-":p(k)({v:a.value/f.value*100,s:"%",r:e.value.style.chart.legend.roundingPercentage}))+") ",1))],12,ut)]),_:1},8,["legendSet","config"])):d("",!0),h(t.$slots,"legend",{legend:ee.value},void 0,!0),ve(We,{show:b.value.showTooltip&&V.value,backgroundColor:e.value.style.chart.tooltip.backgroundColor,color:e.value.style.chart.tooltip.color,borderRadius:e.value.style.chart.tooltip.borderRadius,borderColor:e.value.style.chart.tooltip.borderColor,borderWidth:e.value.style.chart.tooltip.borderWidth,fontSize:e.value.style.chart.tooltip.fontSize,backgroundOpacity:e.value.style.chart.tooltip.backgroundOpacity,position:e.value.style.chart.tooltip.position,offsetY:e.value.style.chart.tooltip.offsetY,parent:G.value,content:E.value,isCustom:p(ie)(e.value.style.chart.tooltip.customFormat)},{"tooltip-before":n(()=>[h(t.$slots,"tooltip-before",O(F({...M.value})),void 0,!0)]),"tooltip-after":n(()=>[h(t.$slots,"tooltip-after",O(F({...M.value})),void 0,!0)]),_:3},8,["show","backgroundColor","color","borderRadius","borderColor","borderWidth","fontSize","backgroundOpacity","position","offsetY","parent","content","isCustom"]),N.value?(r(),w(De,{key:6,hideDetails:"",config:{open:b.value.showTable,maxHeight:1e4,body:{backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color},head:{backgroundColor:e.value.style.chart.backgroundColor,color:e.value.style.chart.color}}},{content:n(()=>[(r(),w(ze,{key:`table_${Y.value}`,colNames:P.value.colNames,head:P.value.head,body:P.value.body,config:P.value.config,title:`${e.value.style.chart.title.text}${e.value.style.chart.title.subtitle.text?` : ${e.value.style.chart.title.subtitle.text}`:""}`,onClose:l[2]||(l[2]=a=>b.value.showTable=!1)},{th:n(({th:a})=>[C("div",{innerHTML:a,style:{display:"flex","align-items":"center"}},null,8,vt)]),td:n(({td:a})=>[he(B(a.name||a),1)]),_:1},8,["colNames","head","body","config","title"]))]),_:1},8,["config"])):d("",!0)],14,Ae))}},Tt=Xe(ct,[["__scopeId","data-v-20ef4a66"]]);export{Tt as default};
