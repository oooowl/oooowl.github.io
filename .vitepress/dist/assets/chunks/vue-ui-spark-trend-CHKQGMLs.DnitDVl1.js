import{o as R,L as U,G as D,X as P,K as H,k as h,Z as J,Q as Y,c as z,w as G,b as V,n as ee}from"../chart.md.hi_nZSnT.js";import{c as A}from"./useNestedProp-S1UXxUgm.CErBICdk.js";import{s as le,u as T}from"./vue-data-ui-Cp7bO_tj.DKBrIOIj.js";import ae from"./vue-ui-skeleton-B2sRnIXX.C3JvNOY7.js";import{p as te}from"./PackageVersion-DtnhR89q.DeJ10Meb.js";import{h as s,p as m,q,v as oe,o as n,c as v,k as y,G as ue,j as k,e as d,b as C,t as Z,N as ne}from"./framework.BaNfDZ-f.js";const se=["id"],ie=["xmlns","viewBox"],re=["id"],ve=["stop-color"],de=["stop-color"],ye={key:0},he=["d","fill"],pe=["d","fill"],ce=["d","stroke","stroke-width","stroke-linecap","stroke-linejoin"],ge=["d","stroke","stroke-width","stroke-linecap","stroke-linejoin"],fe=["height","width","x"],me={style:{width:"100%"}},ke=["x","y","fill","font-size","font-weight"],be=["stroke","cx","cy","fill"],xe=["x","y","font-size","fill","font-weight"],we={__name:"vue-ui-spark-trend",props:{config:{type:Object,default(){return{}}},dataset:{type:Array,default(){return[]}}},setup(E){const o=E,{vue_ui_spark_trend:W}=R(),X=s(()=>!!o.dataset&&o.dataset.length),b=m(U()),e=s({get:()=>S(),set:l=>l});function S(){const l=A({userConfig:o.config,defaultConfig:W});return l.theme?{...A({userConfig:D.vue_ui_spark_trend[l.theme]||o.config,defaultConfig:l})}:l}q(()=>o.config,l=>{e.value=S(),j()},{deep:!0}),q(()=>o.dataset,l=>{g.value=o.dataset.map(t=>[void 0,1/0,-1/0,null,NaN].includes(t)?null:t)},{deep:!0});function $(l){return l.map(t=>h(t))}const g=m(o.dataset.map(l=>e.value.style.animation.show||[void 0,1/0,-1/0,null,NaN].includes(l)?null:l)),f=m(!1),_=m(null);oe(()=>{j();let l=1e3/e.value.style.animation.animationFrames,t=performance.now();if(e.value.style.animation.show&&e.value.style.animation.animationFrames&&o.dataset.length>1){let r=function(){f.value=!0;let F=performance.now(),B=F-t;B>l?(t=F-B%l,c<o.dataset.length?(g.value.push(o.dataset[c]),c+=1,_.value=requestAnimationFrame(r)):(cancelAnimationFrame(_.value),g.value=$(o.dataset),f.value=!1)):_.value=requestAnimationFrame(r)};g.value=[];let c=0;r()}});function j(){P(o.dataset)&&H({componentName:"VueUiSparkTrend",type:"dataset"})}const u=m({height:80,width:300}),p=s(()=>({top:e.value.style.padding.top,left:e.value.style.padding.left,right:u.value.width-e.value.style.padding.right,bottom:u.value.height-e.value.style.padding.bottom,height:u.value.height-(e.value.style.padding.top+e.value.style.padding.bottom)-(e.value.style.dataLabel.show?e.value.style.dataLabel.fontSize:0),width:u.value.width-(e.value.style.padding.left+e.value.style.padding.right)})),N=s(()=>{const l=$(o.dataset);return{max:Math.max(...l.map(t=>h(t))),min:Math.min(...l.map(t=>h(t)))}}),x=s(()=>{const l=N.value.min>=0?0:N.value.min;return Math.abs(l)}),I=s(()=>N.value.max+x.value);function M(l){return l/I.value}const K=s(()=>o.dataset.length),a=s(()=>g.value.map((l,t)=>{const r=isNaN(l)||[void 0,null,"NaN",NaN,1/0,-1/0].includes(l)?0:l||0;return{value:h(l),absoluteValue:h(r),plotValue:h(r+x.value),toMax:M(r+x.value),x:p.value.left+h(t*(p.value.width/(K.value-1)))-e.value.style.padding.right,y:p.value.bottom-h(p.value.height*M(r+x.value))}})),w=s(()=>{const l=$(o.dataset);return e.value.style.trendLabel.trendType==="global"?J(l):e.value.style.trendLabel.trendType==="n-1"&&l.length>1?(l.at(-1)/l.at(-2)-1)*100:e.value.style.trendLabel.trendType==="lastToFirst"?(l.at(-1)/l[0]-1)*100:0}),L=s(()=>f.value||w.value===0?"neutral":w.value>0?"positive":"negative"),i=s(()=>e.value.style.arrow.colors[L.value]),O=s(()=>{const l={x:a.value[0].x,y:u.value.height-6},t={x:a.value[a.value.length-1].x,y:u.value.height-6},r=[];return a.value.forEach(c=>{r.push(`${c.x},${c.y} `)}),[l.x,l.y,...r,t.x,t.y].toString()}),Q=s(()=>{let l=[];return a.value.forEach(t=>{l.push(`${t.x},${t.y} `)}),`M ${l.toString()}`});return(l,t)=>(n(),v("div",{class:"vue-ui-spark-trend",id:b.value,style:ne(`width:100%;font-family:${e.value.style.fontFamily};background:${e.value.style.backgroundColor}`)},[X.value?(n(),v("svg",{key:1,xmlns:y(Y),viewBox:`0 0 ${u.value.width} ${u.value.height}`,style:"width:100%;background:transparent;overflow:visible"},[ue(te),k("defs",null,[k("linearGradient",{x1:"0%",y1:"0%",x2:"0%",y2:"100%",id:`pill_gradient_${b.value}`},[k("stop",{offset:"0%","stop-color":y(z)(e.value.style.line.useColorTrend?i.value:e.value.style.line.stroke,e.value.style.area.opacity)},null,8,ve),k("stop",{offset:"100%","stop-color":e.value.style.backgroundColor},null,8,de)],8,re)]),e.value.style.area.show&&a.value[0]?(n(),v("g",ye,[e.value.style.line.smooth?(n(),v("path",{key:0,d:`M ${a.value[0].x},${p.value.bottom} ${y(G)(a.value)} L ${a.value.at(-1).x},${p.value.bottom} Z`,fill:e.value.style.area.useGradient?`url(#pill_gradient_${b.value})`:y(z)(e.value.style.line.useColorTrend?i.value:e.value.style.line.stroke,e.value.style.area.opacity),stroke:"none"},null,8,he)):(n(),v("path",{key:1,d:`M${O.value}Z`,fill:e.value.style.area.useGradient?`url(#pill_gradient_${b.value})`:y(z)(e.value.style.line.useColorTrend?i.value:e.value.style.line.stroke,e.value.style.area.opacity),stroke:"none"},null,8,pe))])):d("",!0),e.value.style.line.smooth&&a.value.length?(n(),v("path",{key:1,d:`M ${y(G)(a.value)}`,stroke:e.value.style.line.useColorTrend?i.value:e.value.style.line.stroke,fill:"none","stroke-width":e.value.style.line.strokeWidth,"stroke-linecap":e.value.style.line.strokeLinecap,"stroke-linejoin":e.value.style.line.strokeLinejoin},null,8,ce)):d("",!0),!e.value.style.line.smooth&&a.value.length?(n(),v("path",{key:2,d:Q.value,stroke:e.value.style.line.useColorTrend?i.value:e.value.style.line.stroke,fill:"none","stroke-width":e.value.style.line.strokeWidth,"stroke-linecap":e.value.style.line.strokeLinecap,"stroke-linejoin":e.value.style.line.strokeLinejoin},null,8,ge)):d("",!0),f.value?d("",!0):(n(),v("foreignObject",{key:3,height:u.value.height/2,width:u.value.height/2,x:u.value.height/5,y:8},[k("div",me,[L.value==="positive"?(n(),C(T,{key:0,stroke:i.value,name:"arrowTop",size:u.value.height/2},null,8,["stroke","size"])):d("",!0),L.value==="negative"?(n(),C(T,{key:1,stroke:i.value,name:"arrowBottom",size:u.value.height/2},null,8,["stroke","size"])):d("",!0),L.value==="neutral"?(n(),C(T,{key:2,stroke:i.value,name:"arrowRight",size:u.value.height/2},null,8,["stroke","size"])):d("",!0)])],8,fe)),f.value?d("",!0):(n(),v("text",{key:4,x:u.value.height/2-u.value.height/20,y:p.value.bottom,"text-anchor":"middle",fill:e.value.style.trendLabel.useColorTrend?i.value:e.value.style.trendLabel.color,"font-size":e.value.style.trendLabel.fontSize,"font-weight":e.value.style.trendLabel.bold?"bold":"normal"},Z(y(V)({p:w.value>0?"+":"",v:w.value,s:"%",r:e.value.style.trendLabel.rounding})),9,ke)),a.value.length&&a.value.at(-1).x!==void 0?(n(),v("circle",{key:5,stroke:e.value.style.backgroundColor,"stroke-width":2,cx:a.value.at(-1).x,cy:a.value.at(-1).y,r:4,fill:i.value},null,8,be)):d("",!0),a.value.length&&a.value.at(-1).x!==void 0&&e.value.style.dataLabel.show?(n(),v("text",{key:6,"text-anchor":"middle",x:a.value.at(-1).x,y:a.value.at(-1).y-e.value.style.dataLabel.fontSize/1.5,"font-size":e.value.style.dataLabel.fontSize,fill:e.value.style.dataLabel.useColorTrend?i.value:e.value.style.dataLabel.color,"font-weight":e.value.style.dataLabel.bold?"bold":"normal"},Z(y(ee)(e.value.style.dataLabel.formatter,a.value.at(-1).value,y(V)({p:e.value.style.dataLabel.prefix,v:a.value.at(-1).value,s:e.value.style.dataLabel.suffix,r:e.value.style.dataLabel.rounding}),{datapoint:a.value.at(-1)})),9,xe)):d("",!0)],8,ie)):(n(),C(ae,{key:0,config:{type:"sparkline",style:{backgroundColor:e.value.style.backgroundColor,sparkline:{color:"#CCCCCC"}}}},null,8,["config"]))],12,se))}},Te=le(we,[["__scopeId","data-v-541bb7c5"]]);export{Te as default};
