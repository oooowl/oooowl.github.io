import{o as T,L as U,G as Q,R,e as b,a as X,X as H,K as V,q as J,j as Y,n as x,b as k,Q as Z,c as $,p as ee}from"../chart.md.hi_nZSnT.js";import{c as G}from"./useNestedProp-S1UXxUgm.CErBICdk.js";import te from"./vue-ui-skeleton-B2sRnIXX.C3JvNOY7.js";import{p as ae}from"./PackageVersion-DtnhR89q.DeJ10Meb.js";import{h as g,p as w,q as P,v as le,P as oe,o as n,c as v,r as j,ak as q,K as se,e as p,N as c,j as d,t as y,F as I,C as re,al as ie,k as s,G as ue,b as ne}from"./framework.BaNfDZ-f.js";import"./vue-data-ui-Cp7bO_tj.DKBrIOIj.js";const ve=["onClick"],de={key:1},pe=["xmlns","viewBox"],ce=["id"],ye=["stop-color"],me=["stop-color"],fe=["height","width","fill","rx"],ge=["height","width","fill","rx"],he=["height","width","fill","rx"],Se={__name:"vue-ui-sparkbar",props:{config:{type:Object,default(){return{}}},dataset:{type:Array,default(){return[]}},backgroundOpacity:{type:Number,default:null}},emits:["selectDatapoint"],setup(C,{emit:L}){const l=C,{vue_ui_sparkbar:O}=T(),S=g(()=>!!l.dataset&&l.dataset.length),_=w(U()),e=g({get:()=>A(),set:t=>t});function A(){const t=G({userConfig:l.config,defaultConfig:O});return t.theme?{...G({userConfig:Q.vue_ui_sparkbar[t.theme]||l.config,defaultConfig:t}),customPalette:R[t.theme]||b}:t}P(()=>l.config,t=>{e.value=A()},{deep:!0});const D=g(()=>X(e.value.customPalette)),m=w(l.dataset.map(t=>({...t,value:e.value.style.animation.show?0:t.value||0,formatter:t.formatter||null}))),z=w(null);le(async()=>{H(l.dataset)&&V({componentName:"VueUiSparkbar",type:"dataset"}),F()});function F(){if(e.value.style.animation.show){let t=function(){B+=u/o,B<u?(m.value=m.value.map((r,h)=>({...r,value:r.value+=a[h]})),z.value=requestAnimationFrame(t)):m.value=l.dataset.map(r=>({...r,value:r.value||0,formatter:r.formatter||null}))};const o=e.value.style.animation.animationFrames,a=l.dataset.map((r,h)=>r.value/o),u=l.dataset.map(r=>r.value||0).reduce((r,h)=>r+h,0);let B=0;t()}}P(()=>l.dataset,async t=>{cancelAnimationFrame(z.value),m.value=l.dataset.map(o=>({...o,value:e.value.style.animation.show?0:o.value||0,formatter:o.formatter||null})),oe(F)},{deep:!0});const i=w({width:500,height:16}),W=g(()=>Math.max(...l.dataset.map(t=>t.value))),E=g(()=>(l.dataset.forEach((t,o)=>{J({datasetObject:t,requiredAttributes:["name","value"]}).forEach(a=>{V({componentName:"VueUiSparkbar",type:"datasetSerieAttribute",property:a,index:o})})}),m.value.map((t,o)=>({...t,value:t.value||0,color:Y(t.color)||D.value[o]||b[o]||b[o%b.length]}))));function K(t){return t/W.value}function N(t){return e.value.style.layout.independant?t.target?t.value/t.target:e.value.style.layout.percentage?t.value>100?1:t.value/100:e.value.style.layout.target===0?1:t.value/e.value.style.layout.target:K(t.value)}function f(t){return e.value.style.layout.independant&&t.target||e.value.style.layout.target}function M(t,o){L("selectDatapoint",{datapoint:t,index:o})}return(t,o)=>(n(),v("div",{style:c({width:"100%",fontFamily:e.value.style.fontFamily,background:l.backgroundOpacity!==null?s($)(e.value.style.backgroundColor,l.backgroundOpacity):e.value.style.backgroundColor})},[t.$slots.title?j(t.$slots,"title",q(se({key:0},{title:{...t.title,title:e.value.style.title.text,subtitle:e.value.style.title.subtitle.text}}))):p("",!0),!t.$slots.title&&e.value.style.title.text?(n(),v("div",{key:1,class:"vue-ui-sparkbar-title-container",style:c({background:e.value.style.title.backgroundColor,margin:e.value.style.title.margin,textAlign:e.value.style.title.textAlign})},[d("div",{class:"vue-ui-sparkbar-title",style:c({fontSize:e.value.style.title.fontSize+"px",color:e.value.style.title.color,fontWeight:e.value.style.title.bold?"bold":"normal"})},y(e.value.style.title.text),5),e.value.style.title.subtitle.text?(n(),v("div",{key:0,class:"vue-ui-sparkbar-subtitle",style:c({fontSize:e.value.style.title.subtitle.fontSize+"px",color:e.value.style.title.subtitle.color,fontWeight:e.value.style.title.subtitle.bold?"bold":"normal"})},y(e.value.style.title.subtitle.text),5)):p("",!0)],4)):p("",!0),(n(!0),v(I,null,re(E.value,(a,u)=>(n(),v(I,null,[S.value?(n(),v("div",{key:0,style:c(`display:flex !important;${["left","right"].includes(e.value.style.labels.name.position)?`flex-direction: ${e.value.style.labels.name.position==="right"?"row-reverse":"row"} !important`:"flex-direction:column !important"};gap:${e.value.style.gap}px !important;align-items:center;${C.dataset.length>0&&u!==C.dataset.length-1?"margin-bottom:6px":""}`),onClick:()=>M(a,u)},[j(t.$slots,"data-label",q(ie({bar:{...a,target:f(a),valueLabel:s(x)(a.formatter,a.value,s(k)({p:a.prefix||"",v:a.value,s:a.suffix||"",r:a.rounding||0}),{datapoint:a,seriesIndex:u}),targetLabel:s(x)(a.formatter,f(a),s(k)({p:a.prefix||"",v:f(a),s:a.suffix||"",r:a.rounding||0}),{datapoint:a,seriesIndex:u})}}))),t.$slots["data-label"]?p("",!0):(n(),v("div",{key:0,style:c({width:e.value.style.labels.name.width,color:e.value.style.labels.name.color,fontSize:e.value.style.labels.fontSize+"px",fontWeight:e.value.style.labels.name.bold?"bold":"normal",textAlign:["left","right"].includes(e.value.style.labels.name.position)||["top","top-left"].includes(e.value.style.labels.name.position)?"left":e.value.style.labels.name.position==="top-center"?"center":"right"})},[d("span",null,y(a.name),1),e.value.style.labels.value.show?(n(),v("span",{key:0,style:c(`font-weight:${e.value.style.labels.value.bold?"bold":"normal"}`)},": "+y(s(x)(a.formatter,a.value,s(k)({p:a.prefix||"",v:a.value,s:a.suffix||"",r:a.rounding||0}),{datapoint:a,seriesIndex:u})),5)):p("",!0),e.value.style.layout.showTargetValue?(n(),v("span",de,y(" "+e.value.style.layout.targetValueText)+" "+y(s(x)(a.formatter,f(a),s(k)({p:a.prefix||"",v:f(a),s:a.suffix||"",r:a.rounding||0}),{datapoint:a,seriesIndex:u})),1)):p("",!0)],4)),(n(),v("svg",{xmlns:s(Z),viewBox:`0 0 ${i.value.width} ${i.value.height}`,width:"100%"},[ue(ae),d("defs",null,[d("linearGradient",{x1:"0%",y1:"0%",x2:"100%",y2:"0%",id:`sparkbar_gradient_${u}_${_.value}`},[d("stop",{offset:"0%","stop-color":s($)(s(ee)(a.color,.03),100-e.value.style.bar.gradient.intensity)},null,8,ye),d("stop",{offset:"100%","stop-color":a.color},null,8,me)],8,ce)]),d("rect",{height:i.value.height,width:i.value.width,x:0,y:0,fill:s($)(e.value.style.gutter.backgroundColor,e.value.style.gutter.opacity),rx:i.value.height/2},null,8,fe),d("rect",{height:i.value.height,width:i.value.width*N(a),x:0,y:0,fill:e.value.style.bar.gradient.underlayerColor,rx:i.value.height/2},null,8,ge),d("rect",{height:i.value.height,width:i.value.width*N(a),x:0,y:0,fill:e.value.style.bar.gradient.show?`url(#sparkbar_gradient_${u}_${_.value})`:a.color,rx:i.value.height/2},null,8,he)],8,pe))],12,ve)):p("",!0)],64))),256)),S.value?p("",!0):(n(),ne(te,{key:2,config:{type:"sparkbar",style:{backgroundColor:e.value.style.backgroundColor,sparkbar:{color:"#CCCCCC"}}}},null,8,["config"]))],4))}};export{Se as default};
