import{o as fa,L as pa,G as ba,R as ma,e as E,a as xa,I as he,n as Z,b as j,m as La,j as Ae,W as ka,X as Ca,K as $a,H as Ge,$ as wa,N as za,O as Sa,c as U,M as Ma}from"../chart.md.hi_nZSnT.js";import{E as Ta,k as Ia,b as Ze,O as Oa,C as L,L as ye,I as O,m as je,M as Ra}from"./useResponsive-NZB-WLRF.DbXjWqi_.js";import{E as _a}from"./Tooltip-CICAYyQj.DC7pN5Ho.js";import{C as Fa}from"./Legend-DXLiSLHd.5wpQgPWV.js";import{x as Ea}from"./Title-DYNLqCCT.D6xZGHSM.js";import{_ as Pa}from"./Slicer-BZfUZr1J.DTx2MfEZ.js";import{s as Na,i as Wa}from"./usePrinter-8ofTb2MJ.pt_J2AaR.js";import Ha from"./vue-ui-accordion-D_1fE5EF.ggAyum2g.js";import{W as Ya}from"./DataTable-DL2agEJ3.DwhyhpBD.js";import Ba from"./vue-ui-skeleton-B2sRnIXX.C3JvNOY7.js";import{c as Ue}from"./useNestedProp-S1UXxUgm.CErBICdk.js";import{s as Da}from"./vue-data-ui-Cp7bO_tj.DKBrIOIj.js";import{p as c,h as f,q as D,v as Xa,Y as Aa,o as $,c as re,N as V,b as P,e as q,aj as Ga,w as p,r as k,ak as K,al as Q,k as N,j as J,G as Za,t as Ve,a as ja,n as Ua}from"./framework.BaNfDZ-f.js";import"./Shape-CO_Ak9Zm.UkrUmJI7.js";import"./PackageVersion-DtnhR89q.DeJ10Meb.js";const Va=["id"],qa=["onClick"],Ka={key:2,class:"vue-data-ui-watermark"},Qa=["innerHTML"],Ja={__name:"vue-ui-xy-canvas",props:{dataset:{type:Array,default(){return[]}},config:{type:Object,default(){return{}}}},emits:["selectLegend"],setup(ge,{expose:qe,emit:Ke}){const R=ge,{vue_ui_xy_canvas:Qe}=fa(),ie=c(pa()),ee=c(null),w=c(null),X=c(null),i=c(null),y=c(1),T=c(1),ae=c(!1),d=c(null),le=c(""),fe=c(null),C=c([]),W=c(1),_=c(!0),z=c(!0),ne=c(null),pe=c(0),be=c(0),ve=c(!1),me=c(null),xe=c(null),Le=c(null),ke=c(0),Ce=c(0),$e=c(0),ce=f(()=>!!R.dataset&&R.dataset.length),a=f({get:()=>we(),set:e=>e});function we(){const e=Ue({userConfig:R.config,defaultConfig:Qe});return e.theme?{...Ue({userConfig:ba.vue_ui_xy_canvas[e.theme]||R.config,defaultConfig:e}),customPalette:ma[e.theme]||E}:e}D(()=>R.config,e=>{a.value=we(),Ee(),ke.value+=1,Ce.value+=1,$e.value+=1},{deep:!0});const ze=c(a.value.style.chart.aspectRatio),{isPrinting:Se,isImaging:Me,generatePdf:Te,generateImage:Ie}=Na({elementId:`xy_canvas_${ie.value}`,fileName:a.value.style.chart.title.text||"vue-ui-xy-canvas"}),u=c({showTable:a.value.table.show,showDataLabels:a.value.style.chart.dataLabels.show,stacked:a.value.style.chart.stacked,showTooltip:a.value.style.chart.tooltip.show});function Je(e){ve.value=e,be.value+=1}const Oe=f(()=>xa(a.value.customPalette)),I=f(()=>H.value?Math.max(...H.value.filter((e,t)=>!C.value.includes(e.absoluteIndex)).map(e=>e.series.length)):0),l=f(()=>{const e=y.value-y.value*(a.value.style.chart.paddingProportions.left+a.value.style.chart.paddingProportions.right);return{canvasWidth:y.value,canvasHeight:T.value,left:y.value*a.value.style.chart.paddingProportions.left,top:T.value*a.value.style.chart.paddingProportions.top,right:y.value-y.value*a.value.style.chart.paddingProportions.right,bottom:T.value-T.value*a.value.style.chart.paddingProportions.bottom,width:e,height:T.value-T.value*(a.value.style.chart.paddingProportions.top+a.value.style.chart.paddingProportions.bottom),slot:e/(s.value.end-s.value.start)}});function Re(e,t){return e/t}function ea({hasAutoScale:e,series:t,min:o,max:v,scale:n,yOffset:m,individualHeight:r,stackIndex:x=null}){return t.map((S,F)=>{const Y=n.min<0?Math.abs(n.min):0,B=Re(S+Y,Y+n.max);let A,G;e&&(A=Math.abs(n.min),G=Re(S+A,n.max+A));let M=0;return x===null?M=l.value.bottom-l.value.height*(e?G:B):M=l.value.bottom-m-r*(e?G:B),{x:l.value.left+l.value.slot*F+l.value.slot/2,y:M,value:S}})}const g=f(()=>{const e=Math.min(...H.value.filter((r,x)=>!C.value.includes(r.absoluteIndex)).flatMap(r=>r.series.slice(s.value.start,s.value.end))),t=Math.max(...H.value.filter((r,x)=>!C.value.includes(r.absoluteIndex)).flatMap(r=>r.series.slice(s.value.start,s.value.end))),o=he(e<0?e:0,t===e?e+1<0?0:e+1:t<0?0:t,a.value.style.chart.scale.ticks),v=o.min<0?Math.abs(o.min):0,n=l.value.bottom-l.value.height*(v/(o.max+v)),m=o.ticks.map(r=>({y:l.value.bottom-l.value.height*((r+v)/(o.max+v)),x:l.value.left-8,value:r}));return{absoluteMin:v,max:t,min:e,scale:o,yLabels:m,zero:n}}),aa=f(()=>h.value.map(e=>`
            <div style="display:flex;flex-direction:row;gap:6px;align-items:center;">
                <svg viewBox="0 0 10 10" height="12" width="12">
                    <circle cx="5" cy="5" r="5" fill="${e.color}"/>
                </svg>
                <span>${e.name?e.name+": ":""}</span>
                <span>${Z(a.value.style.chart.dataLabels.formatter,e.series[d.value],j({p:e.prefix||"",v:e.series[d.value],s:e.suffix||"",r:e.rounding||0}),{datapoint:e,seriesIndex:d.value})}</span>
            </div>
        `)),H=f(()=>R.dataset.map((e,t)=>({...e,series:La(e.series),absoluteIndex:t,color:Ae(e.color||Oe.value[t]||E[t]||E[t%E.length])})));D(I,e=>{e&&_e()});const h=f(()=>ka(H.value.filter((e,t)=>!C.value.includes(e.absoluteIndex))).map((e,t)=>({...e,series:e.series.slice(s.value.start,s.value.end)})).map((e,t)=>{let o=Math.min(...e.series)||0,v=Math.max(...e.series)||1;o===v&&(o=o>=0?v-1:o,v=v>=0?v:o+1);const n={ratios:e.series.filter(M=>![null,void 0].includes(M)).map(M=>(M-o)/(v-o)),valueMin:o,valueMax:v},m=e.scaleSteps||a.value.style.chart.scale.ticks;let r;e.autoScaling?r=he(n.valueMin,n.valueMax,m):r=he(n.valueMin<0?n.valueMin:0,n.valueMax<=0?0:n.valueMax,m);const x=u.value.stacked?l.value.height*(1-e.cumulatedStackRatio):0,S=u.value.stacked?l.value.height/a.value.style.chart.stackGap:0,F=u.value.stacked?l.value.height*e.stackRatio-S:l.value.height,Y=r.min<0?Math.abs(r.min):0;let B;e.autoScaling&&u.value.stacked&&v<=0?B=l.value.bottom-x-F:B=l.value.bottom-x-F*(Y/(r.max+Y));const A=r.ticks.map((M,ga)=>({y:l.value.bottom-x-F*(ga/(r.ticks.length-1)),x:l.value.left-8,value:M})),G=ea({hasAutoScale:u.value.stacked&&e.autoScaling,series:e.series,min:u.value.stacked?o:g.value.min,max:u.value.stacked?v:g.value.max,scale:u.value.stacked?r:g.value.scale,yOffset:x,individualHeight:F,stackIndex:u.value.stacked?t:null});return{...e,coordinatesLine:G,min:o,max:v,localScale:r,localZero:B,localMin:Y,localYLabels:A,yOffset:x,individualHeight:F}})),s=c({start:0,end:I.value});function _e(){s.value={start:0,end:I.value},pe.value+=1}const la=f(()=>h.value.filter(e=>["line","plot",void 0].includes(e.type))),b=f(()=>h.value.filter(e=>e.type==="bar"));function ta(){if(!w.value)return;const e=X.value.offsetWidth,t=X.value.offsetHeight;w.value.width=e*W.value*2,w.value.height=t*W.value*2,y.value=e*W.value*2,T.value=t*W.value*2,i.value.scale(W.value,W.value),de()}function oa(){if(i.value.clearRect(0,0,1e4,1e4),i.value.fillStyle=a.value.style.chart.backgroundColor,i.value.fillRect(0,0,l.value.canvasWidth,l.value.canvasHeight),u.value.stacked)a.value.style.chart.grid.y.verticalLines.show&&s.value.end-s.value.start<a.value.style.chart.grid.y.verticalLines.hideUnderXLength&&h.value.forEach(e=>{for(let t=0;t<s.value.end-s.value.start+1;t+=1)L(i.value,[{x:l.value.left+l.value.slot*t,y:l.value.bottom-e.yOffset-e.individualHeight},{x:l.value.left+l.value.slot*t,y:l.value.bottom-e.yOffset}],{color:a.value.style.chart.grid.y.verticalLines.color})}),a.value.style.chart.grid.x.horizontalLines.show&&(a.value.style.chart.grid.x.horizontalLines.alternate?h.value.forEach(e=>{e.localYLabels.forEach((t,o)=>{o<e.localYLabels.length-1&&ye(i.value,[{x:l.value.left,y:t.y},{x:l.value.right,y:t.y},{x:l.value.right,y:e.localYLabels[o+1].y},{x:l.value.left,y:e.localYLabels[o+1].y}],{fillColor:o%2===0?"transparent":U(a.value.style.chart.grid.x.horizontalLines.color,a.value.style.chart.grid.x.horizontalLines.opacity),strokeColor:"transparent"})})}):h.value.forEach(e=>{e.localYLabels.slice(s.value.start,s.value.end).forEach(t=>{L(i.value,[{x:l.value.left,y:t.y},{x:l.value.right,y:t.y}],{color:a.value.style.chart.grid.x.horizontalLines.color})})})),a.value.style.chart.grid.zeroLine.show&&h.value.forEach(e=>{L(i.value,[{x:l.value.left,y:e.localZero},{x:l.value.right,y:e.localZero}],{color:a.value.style.chart.grid.zeroLine.color,lineDash:a.value.style.chart.grid.zeroLine.dashed?[10,10]:[0,0]})}),a.value.style.chart.grid.y.axisLabels.show&&h.value.forEach(e=>{L(i.value,[{x:l.value.left,y:l.value.bottom-e.yOffset},{x:l.value.left,y:l.value.bottom-e.yOffset-e.individualHeight}],{color:e.color}),L(i.value,[{x:l.value.right,y:l.value.bottom-e.yOffset},{x:l.value.right,y:l.value.bottom-e.yOffset-e.individualHeight}],{color:e.color}),e.localYLabels.forEach((t,o)=>{O(i.value,Z(a.value.style.chart.dataLabels.formatter,t.value,j({p:e.prefix||a.value.style.chart.grid.y.axisLabels.prefix||"",v:t.value,s:e.suffix||a.value.style.chart.grid.y.axisLabels.suffix||"",r:e.rounding||a.value.style.chart.grid.y.axisLabels.rounding||0}),{datapoint:t,seriesIndex:o}),t.x+a.value.style.chart.grid.y.axisLabels.offsetX,t.y,{align:"right",font:`${Math.round(y.value/40*a.value.style.chart.grid.y.axisLabels.fontSizeRatio)}px ${a.value.style.fontFamily}`,color:e.color})})}),h.value.forEach(e=>{O(i.value,e.name,y.value/35,l.value.bottom-e.yOffset-e.individualHeight/2,{align:"center",rotation:-90,color:e.color,font:`${Math.round(y.value/40*a.value.style.chart.grid.y.axisLabels.fontSizeRatio)}px ${a.value.style.fontFamily}`})});else{if(a.value.style.chart.grid.y.verticalLines.show&&s.value.end-s.value.start<a.value.style.chart.grid.y.verticalLines.hideUnderXLength)for(let e=0;e<s.value.end-s.value.start+1;e+=1)L(i.value,[{x:l.value.left+l.value.slot*e,y:l.value.top},{x:l.value.left+l.value.slot*e,y:l.value.bottom}],{color:a.value.style.chart.grid.y.verticalLines.color});a.value.style.chart.grid.x.horizontalLines.show&&(a.value.style.chart.grid.x.horizontalLines.alternate?g.value.yLabels.forEach((e,t)=>{t<g.value.yLabels.length-1&&ye(i.value,[{x:l.value.left,y:e.y},{x:l.value.right,y:e.y},{x:l.value.right,y:g.value.yLabels[t+1].y},{x:l.value.left,y:g.value.yLabels[t+1].y}],{fillColor:t%2===0?"transparent":U(a.value.style.chart.grid.x.horizontalLines.color,a.value.style.chart.grid.x.horizontalLines.opacity),strokeColor:"transparent"})}):g.value.yLabels.forEach(e=>{L(i.value,[{x:l.value.left,y:e.y},{x:l.value.right,y:e.y}],{color:a.value.style.chart.grid.x.horizontalLines.color})})),a.value.style.chart.grid.y.showAxis&&L(i.value,[{x:l.value.left,y:l.value.top},{x:l.value.left,y:l.value.bottom}],{color:a.value.style.chart.grid.y.axisColor,lineWidth:a.value.style.chart.grid.y.axisThickness}),a.value.style.chart.grid.x.showAxis&&L(i.value,[{x:l.value.left,y:l.value.bottom},{x:l.value.right,y:l.value.bottom}],{color:a.value.style.chart.grid.x.axisColor,lineWidth:a.value.style.chart.grid.x.axisThickness}),a.value.style.chart.grid.zeroLine.show&&L(i.value,[{x:l.value.left,y:g.value.zero},{x:l.value.right,y:g.value.zero}],{color:a.value.style.chart.grid.zeroLine.color,lineDash:a.value.style.chart.grid.zeroLine.dashed?[10,10]:[0,0]}),a.value.style.chart.grid.y.axisLabels.show&&g.value.yLabels.forEach((e,t)=>{O(i.value,Z(a.value.style.chart.dataLabels.formatter,e.value,j({p:a.value.style.chart.grid.y.axisLabels.prefix||"",v:e.value,s:a.value.style.chart.grid.y.axisLabels.suffix||"",r:a.value.style.chart.grid.y.axisLabels.rounding||0}),{datapoint:e,seriesIndex:t}),e.x+a.value.style.chart.grid.y.axisLabels.offsetX,e.y,{align:"right",font:`${Math.round(y.value/40*a.value.style.chart.grid.y.axisLabels.fontSizeRatio)}px ${a.value.style.fontFamily}`,color:a.value.style.chart.grid.y.axisLabels.color})})}a.value.style.chart.grid.y.axisName&&O(i.value,a.value.style.chart.grid.y.axisName,y.value-y.value/40*a.value.style.chart.grid.y.axisLabels.fontSizeRatio*1.2,l.value.bottom-l.value.height/2,{font:`${Math.round(y.value/40*a.value.style.chart.grid.y.axisLabels.fontSizeRatio)}px ${a.value.style.fontFamily}`,color:a.value.style.chart.color,align:"center",rotation:90}),a.value.style.chart.grid.x.axisName&&O(i.value,a.value.style.chart.grid.x.axisName,y.value/2,T.value,{font:`${Math.round(y.value/40*a.value.style.chart.grid.y.axisLabels.fontSizeRatio)}px ${a.value.style.fontFamily}`,color:a.value.style.chart.color,align:"center"})}function sa(e){for(let t=0;t<e.coordinatesLine.length;t+=1){const o=(d.value===t?y.value/150:a.value.style.chart.line.plots.show?y.value/200:0)*a.value.style.chart.line.plots.radiusRatio;Ze(i.value,{x:e.coordinatesLine[t].x,y:e.coordinatesLine[t].y},o,{color:a.value.style.chart.backgroundColor,fillStyle:e.color,strokeColor:"transparent"})}}function ua(e){for(let t=0;t<e.coordinatesLine.length;t+=1)O(i.value,Z(a.value.style.chart.dataLabels.formatter,e.coordinatesLine[t].value,j({p:e.prefix||"",v:e.coordinatesLine[t].value,s:e.suffix||"",r:e.rounding||0}),{datapoint:e.coordinatesLine[t],seriesIndex:t}),e.coordinatesLine[t].x,e.coordinatesLine[t].y+a.value.style.chart.dataLabels.offsetY,{align:"center",font:`${Math.round(y.value/40*a.value.style.chart.dataLabels.fontSizeRatio)}px ${a.value.style.fontFamily}`,color:a.value.style.chart.dataLabels.useSerieColor?e.color:a.value.style.chart.dataLabels.color,strokeColor:a.value.style.chart.backgroundColor,lineWidth:.8})}function ra(){for(let e=s.value.start;e<s.value.end;e+=1)(s.value.end-s.value.start<a.value.style.chart.grid.y.timeLabels.modulo||s.value.end-s.value.start>=a.value.style.chart.grid.y.timeLabels.modulo&&(e%Math.floor((s.value.end-s.value.start)/a.value.style.chart.grid.y.timeLabels.modulo)===0||e===d.value+s.value.start))&&O(i.value,a.value.style.chart.grid.y.timeLabels.values[e]||e+1,l.value.left+l.value.slot*(e-s.value.start)+l.value.slot/2,l.value.bottom+y.value/a.value.style.chart.grid.y.timeLabels.offsetY,{align:a.value.style.chart.grid.y.timeLabels.rotation===0?"center":a.value.style.chart.grid.y.timeLabels.rotation>0?"left":"right",font:`${Math.round(y.value/40*a.value.style.chart.grid.y.timeLabels.fontSizeRatio)}px ${a.value.style.fontFamily}`,color:U(a.value.style.chart.grid.y.timeLabels.color,d.value!==null?d.value+s.value.start===e?100:20:100),rotation:a.value.style.chart.grid.y.timeLabels.rotation})}function Fe(){L(i.value,[{x:l.value.left+l.value.slot*d.value+l.value.slot/2,y:l.value.top},{x:l.value.left+l.value.slot*d.value+l.value.slot/2,y:l.value.bottom}],{color:a.value.style.chart.selector.color,lineDash:a.value.style.chart.selector.dashed?[8,8]:[0,0],lineWidth:2,linceCap:"round"})}function ia(){b.value.forEach((e,t)=>{for(let o=0;o<e.coordinatesLine.length;o+=1)ye(i.value,[{x:l.value.left+l.value.slot*o+l.value.slot/10+(u.value.stacked?0:l.value.slot/b.value.length*t-(t===0?0:l.value.slot/(5*b.value.length)*t)),y:u.value.stacked?e.localZero:g.value.zero},{x:l.value.left+l.value.slot*o+l.value.slot/10+(u.value.stacked?0:l.value.slot/b.value.length*t-(t===0?0:l.value.slot/(5*b.value.length)*t))+l.value.slot*.8/(u.value.stacked?1:b.value.length),y:u.value.stacked?e.localZero:g.value.zero},{x:l.value.left+l.value.slot*o+l.value.slot/10+(u.value.stacked?0:l.value.slot/b.value.length*t-(t===0?0:l.value.slot/(5*b.value.length)*t))+l.value.slot*.8/(u.value.stacked?1:b.value.length),y:e.coordinatesLine[o].y},{x:l.value.left+l.value.slot*o+l.value.slot/10+(u.value.stacked?0:l.value.slot/b.value.length*t-(t===0?0:l.value.slot/(5*b.value.length)*t)),y:e.coordinatesLine[o].y}],{strokeColor:a.value.style.chart.backgroundColor,gradient:{type:"linear",start:{x:e.coordinatesLine[o].x,y:e.coordinatesLine[o].y},end:{x:e.coordinatesLine[o].x,y:u.value.stacked?e.localZero:g.value.zero},stops:[{offset:0,color:e.color},{offset:1,color:Ma(e.color,.5)}]}}),u.value.showDataLabels&&[!0,void 0].includes(e.dataLabels)&&O(i.value,Z(a.value.style.chart.dataLabels.formatter,e.coordinatesLine[o].value,j({p:e.prefix||"",v:e.coordinatesLine[o].value,s:e.suffix||"",r:e.rounding||0}),{datapoint:e.coordinatesLine[o],seriesIndex:o}),l.value.left+l.value.slot*o+l.value.slot/10+(u.value.stacked?0:l.value.slot/b.value.length*t-(t===0?0:l.value.slot/(5*b.value.length)*t))+l.value.slot*.4/(u.value.stacked?1:b.value.length),(e.coordinatesLine[o].value<0?u.value.stacked?e.localZero:g.value.zero:e.coordinatesLine[o].y)+a.value.style.chart.dataLabels.offsetY,{align:"center",font:`${Math.round(y.value/40*a.value.style.chart.dataLabels.fontSizeRatio)}px ${a.value.style.fontFamily}`,color:a.value.style.chart.dataLabels.useSerieColor?e.color:a.value.style.chart.dataLabels.color,strokeColor:a.value.style.chart.backgroundColor,lineWidth:.8})})}function na(e){e.useArea?u.value.stacked?je(i.value,[{x:e.coordinatesLine[0].x,y:e.localZero},...e.coordinatesLine,{x:e.coordinatesLine.at(-1).x,y:e.localZero}],{fillColor:U(e.color,a.value.style.chart.area.opacity),strokeColor:"transparent"}):je(i.value,[{x:e.coordinatesLine[0].x,y:g.value.zero},...e.coordinatesLine,{x:e.coordinatesLine.at(-1).x,y:g.value.zero}],{fillColor:U(e.color,a.value.style.chart.area.opacity),strokeColor:"transparent"}):L(i.value,e.coordinatesLine,{color:e.color,lineWidth:3})}function va(){h.value.forEach((e,t)=>{L(i.value,[{x:l.value.left,y:l.value.bottom-e.yOffset},{x:l.value.right,y:l.value.bottom-e.yOffset}],{color:a.value.style.chart.grid.x.horizontalLines.color,lineWidth:1})})}function de(){oa(),_.value?(z.value&&d.value!==null&&a.value.style.chart.selector.show&&Fe(),ia(),u.value.stacked&&a.value.style.chart.grid.x.showAxis&&va(),la.value.forEach(e=>{(e.type==="line"||!e.type)&&na(e),z.value&&(sa(e),u.value.showDataLabels&&[!0,void 0].includes(e.dataLabels)&&ua(e))}),ne.value=Ia(w.value)):(ne.value&&(i.value.clearRect(0,0,1e4,1e4),i.value.drawImage(ne.value,0,0)),z.value&&d.value!==null&&a.value.style.chart.selector.show&&Fe(),z.value&&d.value!==null&&h.value.forEach(e=>{if(e.type==="line"||!e.type||e.type==="plot"){if(!e.coordinatesLine[d.value])return;e.coordinatesLine[d.value].x!==void 0&&e.coordinatesLine[d.value].y!==void 0&&Ze(i.value,{x:e.coordinatesLine[d.value].x,y:e.coordinatesLine[d.value].y},y.value/150*a.value.style.chart.line.plots.radiusRatio,{color:a.value.style.chart.backgroundColor,fillStyle:e.color,strokeColor:"transparent"})}})),a.value.style.chart.grid.y.timeLabels.show&&ra(),_.value=!1}const te=Ta(()=>{z.value=!0,ta()},I.value>200?10:1,!z.value);function ca(e){const{left:t}=w.value.getBoundingClientRect(),o=e.clientX-t;if(o*2<l.value.left||o*2>l.value.right){ae.value=!1,d.value=null;return}const v=o*2-l.value.left;if(d.value=Math.floor(v/l.value.slot),ae.value=!0,!z.value)return;let n="";const m=a.value.style.chart.tooltip.customFormat;Ge(m)&&wa(()=>m({seriesIndex:d.value,datapoint:h.value.map(r=>({shape:r.shape||null,name:r.name,color:r.color,type:r.type||"line",value:r.series.find((x,S)=>S===d.value)})),series:h.value,config:a.value}))?le.value=m({seriesIndex:d.value,datapoint:h.value.map(r=>({shape:r.shape||null,name:r.name,color:r.color,type:r.type||"line",value:r.series.find((x,S)=>S===d.value)})),series:h.value,config:a.value}):(a.value.style.chart.grid.y.timeLabels.values.slice(s.value.start,s.value.end)[d.value]&&(n+=`<div style="padding-bottom: 6px; margin-bottom: 4px; border-bottom: 1px solid ${a.value.style.chart.tooltip.borderColor}; width:100%">${a.value.style.chart.grid.y.timeLabels.values.slice(s.value.start,s.value.end)[d.value]}</div>`),n+=aa.value.join(""),le.value=n),z.value=!1}D(()=>d.value,e=>{te()}),D(()=>s.value,e=>{_.value=!0,de()},{deep:!0}),D(()=>u.value.showDataLabels,e=>{_.value=!0,de()}),D(()=>u.value.stacked,e=>{_.value=!0,z.value=!0,te()});function da(){ae.value=!1,d.value=null,le.value=""}const oe=c(null),se=c(null);Xa(()=>{Ee()});function Ee(){if(Ca(R.dataset)?$a({componentName:"VueUiXyCanvas",type:"dataset"}):w.value&&(i.value=w.value.getContext("2d",{willReadFrequently:!0})),a.value.responsive){const e=Oa(()=>{const{width:t,height:o}=Ra({chart:ee.value,title:a.value.style.chart.title.text?me.value:null,legend:a.value.style.chart.legend.show?xe.value:null,slicer:a.value.style.chart.zoom.show&&I.value>1?Le.value:null});ze.value=`${t} / ${o}`});oe.value=new ResizeObserver(e),oe.value.observe(ee.value.parentNode)}se.value=new ResizeObserver(e=>{for(const t of e)t.contentBoxSize&&X.value&&(_.value=!0,te())}),se.value.observe(X.value)}Aa(()=>{se.value&&se.value.disconnect(),oe.value&&oe.value.disconnect()});function Pe(e){Ke("selectLegend",h.value.find(t=>t.absoluteIndex===e)),C.value.includes(e)?C.value=C.value.filter(t=>t!==e):C.value.push(e),_.value=!0,te()}const Ne=f(()=>H.value.map((e,t)=>({...e,name:e.name,color:Ae(e.color)||Oe.value[t]||E[t]||E[t%E.length],shape:e.shape||"circle",prefix:e.prefix||"",suffix:e.suffix||"",rounding:e.rounding||0})).map(e=>({...e,opacity:C.value.includes(e.absoluteIndex)?.5:1,segregate:()=>Pe(e.absoluteIndex),isSegregated:C.value.includes(e.absoluteIndex)}))),ha=f(()=>({cy:"donut-div-legend",backgroundColor:a.value.style.chart.legend.backgroundColor,color:a.value.style.chart.legend.color,fontSize:a.value.style.chart.legend.fontSize,paddingBottom:12,fontWeight:a.value.style.chart.legend.bold?"bold":""})),ue=f(()=>{const e=[""].concat(h.value.map(n=>n.name)).concat(' <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 16v2a1 1 0 0 1 -1 1h-11l6 -7l-6 -7h11a1 1 0 0 1 1 1v2" /></svg>');let t=[];for(let n=0;n<I.value;n+=1){const m=h.value.map(r=>r.series[n]??0).reduce((r,x)=>r+x,0);t.push([a.value.style.chart.grid.y.timeLabels.values.slice(s.value.start,s.value.end)[n]??n+1].concat(h.value.map(r=>(r.series[n]??0).toFixed(a.value.table.rounding))).concat((m??0).toFixed(a.value.table.rounding)))}const o={th:{backgroundColor:a.value.table.th.backgroundColor,color:a.value.table.th.color,outline:a.value.table.th.outline},td:{backgroundColor:a.value.table.td.backgroundColor,color:a.value.table.td.color,outline:a.value.table.td.outline},breakpoint:a.value.table.responsiveBreakpoint},v=[a.value.table.columnNames.period].concat(h.value.map(n=>n.name)).concat(a.value.table.columnNames.total);return{head:e,body:t.slice(0,s.value.end-s.value.start),config:o,colNames:v}}),We=f(()=>{if(h.value.length===0)return{head:[],body:[],config:{},columnNames:[]};const e=h.value.map(o=>({label:o.name,color:o.color,type:o.type})),t=[];for(let o=s.value.start;o<s.value.end;o+=1){const v=[a.value.style.chart.grid.y.timeLabels.values[o]||o+1];h.value.forEach(n=>{v.push(Number((n.series[o]||0).toFixed(a.value.table.rounding)))}),t.push(v)}return{head:e,body:t}});function He(){const e=[[a.value.style.chart.title.text],[a.value.style.chart.title.subtitle.text],[""]],t=["",...We.value.head.map(m=>m.label)],o=We.value.body,v=e.concat([t]).concat(o),n=za(v);Sa({csvContent:n,title:a.value.style.chart.title.text||"vue-ui-xy-canvas"})}function ya(){return h.value}function Ye(){u.value.showTable=!u.value.showTable}function Be(){u.value.showDataLabels=!u.value.showDataLabels}function De(){u.value.stacked=!u.value.stacked}function Xe(){u.value.showTooltip=!u.value.showTooltip}return qe({getData:ya,generateCsv:He,generatePdf:Te,generateImage:Ie,toggleTable:Ye,toggleLabels:Be,toggleStack:De,toggleTooltip:Xe}),(e,t)=>($(),re("div",{style:V(`width:100%; position: relative;${a.value.responsive?"height: 100%":""}`),ref_key:"xy",ref:ee,id:`xy_canvas_${ie.value}`,class:Ua(`vue-ui-donut ${ve.value?"vue-data-ui-wrapper-fullscreen":""}`)},[a.value.style.chart.title.text?($(),re("div",{key:0,ref_key:"chartTitle",ref:me,style:V(`width:100%;background:${a.value.style.chart.backgroundColor};`)},[($(),P(Ea,{key:`title_${ke.value}`,config:{title:{cy:"xy-canvas-title",...a.value.style.chart.title},subtitle:{cy:"xy-canvas-subtitle",...a.value.style.chart.title.subtitle}}},null,8,["config"]))],4)):q("",!0),a.value.userOptions.show&&ce.value?($(),P(Wa,{ref:"details",key:`user_option_${be.value}`,backgroundColor:a.value.style.chart.backgroundColor,color:a.value.style.chart.color,isPrinting:N(Se),isImaging:N(Me),uid:ie.value,hasTooltip:a.value.userOptions.buttons.tooltip&&a.value.style.chart.tooltip.show,hasPdf:a.value.userOptions.buttons.pdf,hasImg:a.value.userOptions.buttons.img,hasXls:a.value.userOptions.buttons.csv,hasLabel:a.value.userOptions.buttons.labels,hasStack:ge.dataset.length>1&&a.value.userOptions.buttons.stack,hasFullscreen:a.value.userOptions.buttons.fullscreen,hasTable:s.value.end-s.value.start<200&&a.value.userOptions.buttons.table,isFullscreen:ve.value,isTooltip:u.value.showTooltip,isStacked:u.value.stacked,titles:{...a.value.userOptions.buttonTitles},chartElement:ee.value,position:a.value.userOptions.position,onToggleFullscreen:Je,onGeneratePdf:N(Te),onGenerateCsv:He,onGenerateImage:N(Ie),onToggleTable:Ye,onToggleLabels:Be,onToggleStack:De,onToggleTooltip:Xe},Ga({_:2},[e.$slots.optionTooltip?{name:"optionTooltip",fn:p(()=>[k(e.$slots,"optionTooltip",{},void 0,!0)]),key:"0"}:void 0,e.$slots.optionPdf?{name:"optionPdf",fn:p(()=>[k(e.$slots,"optionPdf",{},void 0,!0)]),key:"1"}:void 0,e.$slots.optionCsv?{name:"optionCsv",fn:p(()=>[k(e.$slots,"optionCsv",{},void 0,!0)]),key:"2"}:void 0,e.$slots.optionImg?{name:"optionImg",fn:p(()=>[k(e.$slots,"optionImg",{},void 0,!0)]),key:"3"}:void 0,e.$slots.optionTable?{name:"optionTable",fn:p(()=>[k(e.$slots,"optionTable",{},void 0,!0)]),key:"4"}:void 0,e.$slots.optionLabels?{name:"optionLabels",fn:p(()=>[k(e.$slots,"optionLabels",{},void 0,!0)]),key:"5"}:void 0,e.$slots.optionStack?{name:"optionStack",fn:p(()=>[k(e.$slots,"optionStack",{},void 0,!0)]),key:"6"}:void 0,e.$slots.optionFullscreen?{name:"optionFullscreen",fn:p(({toggleFullscreen:o,isFullscreen:v})=>[k(e.$slots,"optionFullscreen",K(Q({toggleFullscreen:o,isFullscreen:v})),void 0,!0)]),key:"7"}:void 0]),1032,["backgroundColor","color","isPrinting","isImaging","uid","hasTooltip","hasPdf","hasImg","hasXls","hasLabel","hasStack","hasFullscreen","hasTable","isFullscreen","isTooltip","isStacked","titles","chartElement","position","onGeneratePdf","onGenerateImage"])):q("",!0),J("div",{class:"vue-ui-xy-canvas",style:V(`position: relative; aspect-ratio: ${ze.value}`),ref_key:"container",ref:X},[ce.value?($(),re("canvas",{key:0,ref_key:"canvas",ref:w,style:{width:"100%",height:"100%"},onMousemove:t[0]||(t[0]=o=>ca(o)),onMouseleave:da},null,544)):($(),P(Ba,{key:1,config:{type:"line",style:{backgroundColor:a.value.style.chart.backgroundColor,line:{axis:{color:"#CCCCCC"},path:{color:"#CCCCCC",strokeWidth:.5}}}}},null,8,["config"])),Za(_a,{show:u.value.showTooltip&&ae.value,backgroundColor:a.value.style.chart.tooltip.backgroundColor,color:a.value.style.chart.tooltip.color,fontSize:a.value.style.chart.tooltip.fontSize,borderRadius:a.value.style.chart.tooltip.borderRadius,borderColor:a.value.style.chart.tooltip.borderColor,borderWidth:a.value.style.chart.tooltip.borderWidth,position:a.value.style.chart.tooltip.position,offsetY:a.value.style.chart.tooltip.offsetY,parent:w.value,content:le.value,backgroundOpacity:a.value.style.chart.tooltip.backgroundOpacity,isCustom:N(Ge)(a.value.style.chart.tooltip.customFormat)},{"tooltip-before":p(()=>[k(e.$slots,"tooltip-before",K(Q({...fe.value})),void 0,!0)]),"tooltip-after":p(()=>[k(e.$slots,"tooltip-after",K(Q({...fe.value})),void 0,!0)]),_:3},8,["show","backgroundColor","color","fontSize","borderRadius","borderColor","borderWidth","position","offsetY","parent","content","backgroundOpacity","isCustom"])],4),J("div",{ref_key:"chartSlicer",ref:Le,style:V(`width:100%;background:${a.value.style.chart.backgroundColor}`),"data-html2canvas-ignore":""},[a.value.style.chart.zoom.show&&I.value>1?($(),P(Pa,{key:`slicer_${pe.value}`,background:a.value.style.chart.zoom.color,borderColor:a.value.style.chart.backgroundColor,fontSize:a.value.style.chart.zoom.fontSize,useResetSlot:a.value.style.chart.zoom.useResetSlot,labelLeft:a.value.style.chart.grid.y.timeLabels.values[s.value.start]?a.value.style.chart.grid.y.timeLabels.values[s.value.start]:"",labelRight:a.value.style.chart.grid.y.timeLabels.values[s.value.end-1]?a.value.style.chart.grid.y.timeLabels.values[s.value.end-1]:"",textColor:a.value.style.chart.color,inputColor:a.value.style.chart.zoom.color,selectColor:a.value.style.chart.zoom.highlightColor,max:I.value,min:0,valueStart:s.value.start,valueEnd:s.value.end,start:s.value.start,"onUpdate:start":t[1]||(t[1]=o=>s.value.start=o),end:s.value.end,"onUpdate:end":t[2]||(t[2]=o=>s.value.end=o),onReset:_e},{"reset-action":p(({reset:o})=>[k(e.$slots,"reset-action",K(Q({reset:o})),void 0,!0)]),_:3},8,["background","borderColor","fontSize","useResetSlot","labelLeft","labelRight","textColor","inputColor","selectColor","max","valueStart","valueEnd","start","end"])):q("",!0)],4),J("div",{ref_key:"chartLegend",ref:xe},[a.value.style.chart.legend.show&&ce.value?($(),P(Fa,{legendSet:Ne.value,config:ha.value,key:`legend_${$e.value}`,onClickMarker:t[3]||(t[3]=({i:o})=>Pe(o))},{item:p(({legend:o,index:v})=>[J("div",{onClick:n=>o.segregate(),style:V(`opacity:${C.value.includes(v)?.5:1}`)},Ve(o.name),13,qa)]),_:1},8,["legendSet","config"])):k(e.$slots,"legend",{key:1,legend:Ne.value},void 0,!0)],512),e.$slots.watermark?($(),re("div",Ka,[k(e.$slots,"watermark",K(Q({isPrinting:N(Se)||N(Me)})),void 0,!0)])):q("",!0),s.value.end-s.value.start<200?($(),P(Ha,{key:3,hideDetails:"",config:{open:u.value.showTable,maxHeight:1e4,body:{backgroundColor:a.value.style.chart.backgroundColor,color:a.value.style.chart.color},head:{backgroundColor:a.value.style.chart.backgroundColor,color:a.value.style.chart.color}}},{content:p(()=>[($(),P(Ya,{key:`table_${Ce.value}`,colNames:ue.value.colNames,head:ue.value.head,body:ue.value.body,config:ue.value.config,title:`${a.value.style.chart.title.text}${a.value.style.chart.title.subtitle.text?` : ${a.value.style.chart.title.subtitle.text}`:""}`,onClose:t[4]||(t[4]=o=>u.value.showTable=!1)},{th:p(({th:o})=>[J("div",{innerHTML:o},null,8,Qa)]),td:p(({td:o})=>[ja(Ve(o),1)]),_:1},8,["colNames","head","body","config","title"]))]),_:1},8,["config"])):q("",!0)],14,Va))}},gl=Da(Ja,[["__scopeId","data-v-180df9f3"]]);export{gl as default};
