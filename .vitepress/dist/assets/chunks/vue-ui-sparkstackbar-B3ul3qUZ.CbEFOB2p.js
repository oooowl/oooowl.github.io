import{o as H,L as V,G as M,R,e as u,j as C,a as T,X as J,K as E,q as W,b as D,Q as Y,c as Z,p as ee,n as te}from"../chart.md.hi_nZSnT.js";import{c as U}from"./useNestedProp-S1UXxUgm.CErBICdk.js";import le from"./vue-ui-skeleton-B2sRnIXX.C3JvNOY7.js";import{p as ae}from"./PackageVersion-DtnhR89q.DeJ10Meb.js";import{s as oe}from"./vue-data-ui-Cp7bO_tj.DKBrIOIj.js";import{h as y,p as k,q as I,v as ne,o as s,c as r,N as g,j as d,t as b,e as f,k as x,G as se,F as z,C as B,n as j,b as re}from"./framework.BaNfDZ-f.js";const ie=["xmlns","viewBox"],ue=["id"],ce=["stop-color"],de=["stop-color"],ve=["stop-color"],ge={id:"stackPill",clipPathUnits:"objectBoundingBox"},pe=["fill"],he={key:0,"clip-path":"url(#stackPill)"},ye=["height","width","fill"],fe=["onClick","x","width","height","fill","stroke"],me=["width","height","rx"],ke=["onClick"],be={style:{display:"flex","flex-direction":"row","align-items":"center",gap:"4px","justify-content":"center"}},xe=["height","width"],we=["fill"],$e={__name:"vue-ui-sparkstackbar",props:{config:{type:Object,default(){return{}}},dataset:{type:Array,default(){return[]}}},emits:["selectDatapoint"],setup(K,{emit:O}){const i=K,{vue_ui_sparkstackbar:Q}=H(),A=y(()=>!!i.dataset&&i.dataset.length),N=k(V()),e=y({get:()=>q(),set:t=>t});function q(){const t=U({userConfig:i.config,defaultConfig:Q});return t.theme?{...U({userConfig:M.vue_ui_sparkstackbar[t.theme]||i.config,defaultConfig:t}),customPalette:R[t.theme]||u}:t}I(()=>i.config,t=>{e.value=q(),L()},{deep:!0}),I(()=>i.dataset,t=>{m.value=i.dataset.map((a,l)=>({...a,color:a.color?C(a.color):w.value[l]||u[l]||u[l%u.length]}))},{deep:!0});const w=y(()=>T(e.value.customPalette)),m=k(i.dataset.map((t,a)=>({...t,value:e.value.style.animation.show?0:t.value||0,color:t.color?C(t.color):w.value[a]||u[a]||u[a%u.length]}))),$=k(!0);ne(()=>{if(L(),e.value.style.animation.show){let t=function(){h+=o/a,h<o?(m.value=m.value.map((n,c)=>({...n,value:n.value+=l[c],color:n.color?C(n.color):w.value[c]||u[c]||u[c%u.length]})),requestAnimationFrame(t)):($.value=!1,m.value=i.dataset.map((n,c)=>({...n,value:n.value||0,color:n.color?C(n.color):w.value[c]||u[c]||u[c%u.length],id:V()})))};const a=e.value.style.animation.animationFrames,l=i.dataset.map((n,c)=>n.value/a),o=i.dataset.map(n=>n.value||0).reduce((n,c)=>n+c,0);let h=0;$.value=!0,t()}});function L(){J(i.dataset)?E({componentName:"VueUiSparkStackbar",type:"dataset"}):i.dataset.forEach((t,a)=>{W({datasetObject:t,requiredAttributes:["name","value"]}).forEach(l=>{E({componentName:"VueUiSparkStackbar",type:"datasetSerieAttribute",property:l,index:a})})})}const p=k({width:500,height:16}),v=k([]),P=y(()=>i.dataset.map(t=>t.value||0).filter((t,a)=>!v.value.includes(a)).reduce((t,a)=>t+a,0)),F=y(()=>m.value.map((t,a)=>{const l=t.value||0,o=l/P.value,h=isNaN(o)?0:o,n=h*p.value.width;return{...t,value:l,proportion:h,width:n,proportionLabel:D({v:h*100,s:"%",r:e.value.style.legend.percentage.rounding})}})),_=y(()=>F.value.filter((t,a)=>!v.value.includes(a)));function X(t){v.value.includes(t)?v.value=v.value.filter(a=>a!==t):v.value.length<m.value.length-1&&v.value.push(t)}const S=y(()=>{let t=0;const a=[];for(let l=0;l<_.value.length;l+=1)a.push({..._.value[l],start:t}),t+=_.value[l].width;return a});function G(t,a){O("selectDatapoint",{datapoint:t,index:a})}return(t,a)=>(s(),r("div",{style:g(`width:100%; background:${e.value.style.backgroundColor}`)},[e.value.style.title.text?(s(),r("div",{key:0,style:g(`width:calc(100% - 12px);background:transparent;margin:0 auto;margin:${e.value.style.title.margin};padding: 0 6px;text-align:${e.value.style.title.textAlign}`)},[d("div",{style:g(`font-size:${e.value.style.title.fontSize}px;color:${e.value.style.title.color};font-weight:${e.value.style.title.bold?"bold":"normal"}`)},b(e.value.style.title.text),5),e.value.style.title.subtitle.text?(s(),r("div",{key:0,style:g(`font-size:${e.value.style.title.subtitle.fontSize}px;color:${e.value.style.title.subtitle.color};font-weight:${e.value.style.title.subtitle.bold?"bold":"normal"}`)},b(e.value.style.title.subtitle.text),5)):f("",!0)],4)):f("",!0),A.value?(s(),r("svg",{key:1,xmlns:x(Y),width:"100%",viewBox:`0 0 ${p.value.width} ${p.value.height}`},[se(ae),d("defs",null,[(s(!0),r(z,null,B(S.value,(l,o)=>(s(),r("linearGradient",{key:`stack_gradient_${o}`,gradientTransform:"rotate(90)",id:`stack_gradient_${o}_${N.value}`},[d("stop",{offset:"0%","stop-color":l.color},null,8,ce),d("stop",{offset:"50%","stop-color":x(Z)(x(ee)(l.color,.05),100-e.value.style.bar.gradient.intensity)},null,8,de),d("stop",{offset:"100%","stop-color":l.color},null,8,ve)],8,ue))),128)),d("clipPath",ge,[d("rect",{x:"0.005",y:"-2",width:"0.99",height:"5",rx:"3",ry:"3",fill:e.value.style.backgroundColor},null,8,pe)])]),P.value>0?(s(),r("g",he,[d("rect",{x:0,y:0,height:p.value.height,width:S.value.map(l=>l.width).reduce((l,o)=>l+o,0),fill:e.value.style.bar.gradient.underlayerColor,class:j({animated:!$.value})},null,10,ye),(s(!0),r(z,null,B(S.value,(l,o)=>(s(),r("rect",{key:`stack_${o}`,onClick:()=>G(l,o),x:l.start,y:0,width:l.width,height:p.value.height,fill:e.value.style.bar.gradient.show?`url(#stack_gradient_${o}_${N.value})`:l.color,stroke:e.value.style.backgroundColor,"stroke-linecap":"round",class:j({animated:!$.value})},null,10,fe))),128))])):(s(),r("rect",{key:1,x:2,y:1,width:p.value.width-4,height:p.value.height-2,stroke:"#CCCCCC","stroke-width":"2",fill:"transparent",rx:(p.value.height-4)/2},null,8,me))],8,ie)):f("",!0),A.value?f("",!0):(s(),re(le,{key:2,config:{type:"sparkStackbar",style:{backgroundColor:e.value.style.backgroundColor,sparkStackbar:{color:"#CCCCCC"}}}},null,8,["config"])),e.value.style.legend.show?(s(),r("div",{key:3,style:g(`background:transparent;margin:0 auto;margin:${e.value.style.legend.margin};justify-content:${e.value.style.legend.textAlign==="left"?"flex-start":e.value.style.legend.textAlign==="right"?"flex-end":"center"}`),class:"vue-ui-sparkstackbar-legend"},[(s(!0),r(z,null,B(F.value,(l,o)=>(s(),r("div",{style:g(`font-size:${e.value.style.legend.fontSize}px;`),class:j({"vue-ui-sparkstackbar-legend-item":!0,"vue-ui-sparkstackbar-legend-item-unselected":v.value.includes(o)}),onClick:h=>{X(o),G(l,o)}},[d("div",be,[(s(),r("svg",{height:`${e.value.style.legend.fontSize}px`,width:`${e.value.style.legend.fontSize}px`,viewBox:"0 0 10 10"},[d("circle",{cx:5,cy:5,r:5,fill:l.color},null,8,we)],8,xe)),d("span",{style:g(`color:${e.value.style.legend.name.color}; font-weight:${e.value.style.legend.name.bold?"bold":"normal"}`)},b(l.name),5),e.value.style.legend.percentage.show?(s(),r("span",{key:0,style:g(`font-weight:${e.value.style.legend.percentage.bold?"bold":"normal"};color:${e.value.style.legend.percentage.color}`)},b(v.value.includes(o)?" - ":l.proportionLabel),5)):f("",!0),e.value.style.legend.value.show?(s(),r("span",{key:1,style:g(`font-weight:${e.value.style.legend.value.bold?"bold":"normal"};color:${e.value.style.legend.value.color}`)}," ("+b(x(te)(e.value.style.legend.value.formatter,l.value,x(D)({p:e.value.style.legend.value.prefix,v:l.value,s:e.value.style.legend.value.suffix,r:e.value.style.legend.value.rounding}),{datapoint:l,seriesIndex:o}))+") ",5)):f("",!0)])],14,ke))),256))],4)):f("",!0)],4))}},Ae=oe($e,[["__scopeId","data-v-cd0ed8a9"]]);export{Ae as default};
